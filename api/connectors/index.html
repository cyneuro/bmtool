
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for BMTool - A collection of modules to make developing Neuron and BMTK models easier">
      
      
        <meta name="author" content="Neural Engineering Laboratory at the University of Missouri">
      
      
        <link rel="canonical" href="https://cyneuro.github.io/bmtool/api/connectors/">
      
      
        <link rel="prev" href="../synapses/">
      
      
        <link rel="next" href="../bmplot/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Connectors - BMTool Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#connectors-api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="BMTool Documentation" class="md-header__button md-logo" aria-label="BMTool Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BMTool Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Connectors
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/cyneuro/bmtool" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    cyneuro/bmtool
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting-started/" class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../modules/singlecell/" class="md-tabs__link">
          
  
  
  Modules

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../cli/" class="md-tabs__link">
        
  
  
    
  
  CLI

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/single-cell/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../singlecell/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BMTool Documentation" class="md-nav__button md-logo" aria-label="BMTool Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    BMTool Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cyneuro/bmtool" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    cyneuro/bmtool
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/singlecell/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Single Cell
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/synapses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Synapses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/connectors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Connectors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    BMPlot
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            BMPlot
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/bmplot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/bmplot/connections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Connection Plotting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/bmplot/spikes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spike Plotting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/bmplot/lfp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LFP/ECP Plotting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/bmplot/entrainment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entrainment Plotting
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/analysis/spikes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spike Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/analysis/lfp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LFP/ECP Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/analysis/entrainment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entrainment Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/analysis/netcon_reports/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Connectivity
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/slurm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SLURM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/graphs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Graphs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Single Cell
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Single Cell
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/single-cell/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/notebooks/single_cell/Allen_tutorial/singleCellTutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Allen Database Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/notebooks/single_cell/Neuron_hoc/Single-Cell-Tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Neuron Hoc Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Synapses
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Synapses
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/synapses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/notebooks/synapses/synaptic_tuner/bmtk_chem_syn_tuner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BMTK Chemical Synapse Tuner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/notebooks/synapses/synaptic_tuner/neuron_chem_syn_tuner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Neuron Chemical Synapse Tuner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/notebooks/synapses/gap_junction_tuner/gap_junction_tuner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gap Junction Tuner
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Connectors
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Connectors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/connectors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/notebooks/connectors/connectors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Connectors Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    BMPlot
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            BMPlot
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/bmplot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/notebooks/bmplot/bmplot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BMPlot Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/notebooks/analysis/spiking/using_spikes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spikes Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/notebooks/analysis/spectrogram/spectrogram_with_bmtool/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plot Spectrogram
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/notebooks/analysis/phase_locking_value/spike_phase_entrainment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Phase Locking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/notebooks/analysis/phase_locking_value/phase_locking_value.ipynb" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Phase Locking (Dev)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/notebooks/analysis/netcon_report/netcon_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Synapse Report
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    SLURM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            SLURM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/slurm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/notebooks/SLURM/using_BlockRunner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Runner
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../singlecell/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Single Cell
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../synapses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Synapses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Connectors
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Connectors
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Utility Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utility Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.num_prop" class="md-nav__link">
    <span class="md-ellipsis">
      num_prop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.decision" class="md-nav__link">
    <span class="md-ellipsis">
      decision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.decisions" class="md-nav__link">
    <span class="md-ellipsis">
      decisions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.euclid_dist" class="md-nav__link">
    <span class="md-ellipsis">
      euclid_dist
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.spherical_dist" class="md-nav__link">
    <span class="md-ellipsis">
      spherical_dist
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.cylindrical_dist_z" class="md-nav__link">
    <span class="md-ellipsis">
      cylindrical_dist_z
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#probability-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Probability Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Probability Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ProbabilityFunction" class="md-nav__link">
    <span class="md-ellipsis">
      ProbabilityFunction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProbabilityFunction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ProbabilityFunction.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ProbabilityFunction.decisions" class="md-nav__link">
    <span class="md-ellipsis">
      decisions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ProbabilityFunction.probability" class="md-nav__link">
    <span class="md-ellipsis">
      probability
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.DistantDependentProbability" class="md-nav__link">
    <span class="md-ellipsis">
      DistantDependentProbability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DistantDependentProbability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.DistantDependentProbability.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.DistantDependentProbability.decisions" class="md-nav__link">
    <span class="md-ellipsis">
      decisions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UniformInRange" class="md-nav__link">
    <span class="md-ellipsis">
      UniformInRange
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.gaussian" class="md-nav__link">
    <span class="md-ellipsis">
      gaussian
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.GaussianDropoff" class="md-nav__link">
    <span class="md-ellipsis">
      GaussianDropoff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GaussianDropoff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.GaussianDropoff.calc_pmax_from_ptotal" class="md-nav__link">
    <span class="md-ellipsis">
      calc_pmax_from_ptotal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.GaussianDropoff.set_probability_func" class="md-nav__link">
    <span class="md-ellipsis">
      set_probability_func
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.NormalizedReciprocalRate" class="md-nav__link">
    <span class="md-ellipsis">
      NormalizedReciprocalRate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NormalizedReciprocalRate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.NormalizedReciprocalRate.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.NormalizedReciprocalRate.decisions" class="md-nav__link">
    <span class="md-ellipsis">
      decisions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.NormalizedReciprocalRate.probability" class="md-nav__link">
    <span class="md-ellipsis">
      probability
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-base-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Connector Base Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector Base Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.AbstractConnector" class="md-nav__link">
    <span class="md-ellipsis">
      AbstractConnector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AbstractConnector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.AbstractConnector.constant_function" class="md-nav__link">
    <span class="md-ellipsis">
      constant_function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.AbstractConnector.edge_params" class="md-nav__link">
    <span class="md-ellipsis">
      edge_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.AbstractConnector.setup_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      setup_nodes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.is_same_pop" class="md-nav__link">
    <span class="md-ellipsis">
      is_same_pop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.Timer" class="md-nav__link">
    <span class="md-ellipsis">
      Timer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.pr_2_rho" class="md-nav__link">
    <span class="md-ellipsis">
      pr_2_rho
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.rho_2_pr" class="md-nav__link">
    <span class="md-ellipsis">
      rho_2_pr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-implementations" class="md-nav__link">
    <span class="md-ellipsis">
      Connector Implementations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector Implementations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector" class="md-nav__link">
    <span class="md-ellipsis">
      ReciprocalConnector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReciprocalConnector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.add_conn_prop" class="md-nav__link">
    <span class="md-ellipsis">
      add_conn_prop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.calc_pair" class="md-nav__link">
    <span class="md-ellipsis">
      calc_pair
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.connection_number" class="md-nav__link">
    <span class="md-ellipsis">
      connection_number
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.connection_number_info" class="md-nav__link">
    <span class="md-ellipsis">
      connection_number_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.edge_params" class="md-nav__link">
    <span class="md-ellipsis">
      edge_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.free_memory" class="md-nav__link">
    <span class="md-ellipsis">
      free_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.get_conn_prop" class="md-nav__link">
    <span class="md-ellipsis">
      get_conn_prop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.get_nodes_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_nodes_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.initial_all_to_all" class="md-nav__link">
    <span class="md-ellipsis">
      initial_all_to_all
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.iterate_pairs" class="md-nav__link">
    <span class="md-ellipsis">
      iterate_pairs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.make_backward_connection" class="md-nav__link">
    <span class="md-ellipsis">
      make_backward_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.make_connection" class="md-nav__link">
    <span class="md-ellipsis">
      make_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.make_forward_connection" class="md-nav__link">
    <span class="md-ellipsis">
      make_forward_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.node_2_idx_input" class="md-nav__link">
    <span class="md-ellipsis">
      node_2_idx_input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.save_connection_report" class="md-nav__link">
    <span class="md-ellipsis">
      save_connection_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.setup_conditional_backward_probability" class="md-nav__link">
    <span class="md-ellipsis">
      setup_conditional_backward_probability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.setup_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      setup_nodes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector" class="md-nav__link">
    <span class="md-ellipsis">
      UnidirectionConnector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UnidirectionConnector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.add_conn_prop" class="md-nav__link">
    <span class="md-ellipsis">
      add_conn_prop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.connection_number_info" class="md-nav__link">
    <span class="md-ellipsis">
      connection_number_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.edge_params" class="md-nav__link">
    <span class="md-ellipsis">
      edge_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.get_conn_prop" class="md-nav__link">
    <span class="md-ellipsis">
      get_conn_prop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.get_nodes_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_nodes_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.make_connection" class="md-nav__link">
    <span class="md-ellipsis">
      make_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.save_connection_report" class="md-nav__link">
    <span class="md-ellipsis">
      save_connection_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.setup_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      setup_nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.setup_variables" class="md-nav__link">
    <span class="md-ellipsis">
      setup_variables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.GapJunction" class="md-nav__link">
    <span class="md-ellipsis">
      GapJunction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GapJunction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.GapJunction.make_connection" class="md-nav__link">
    <span class="md-ellipsis">
      make_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.GapJunction.save_connection_report" class="md-nav__link">
    <span class="md-ellipsis">
      save_connection_report
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.CorrelatedGapJunction" class="md-nav__link">
    <span class="md-ellipsis">
      CorrelatedGapJunction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CorrelatedGapJunction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.CorrelatedGapJunction.make_connection" class="md-nav__link">
    <span class="md-ellipsis">
      make_connection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.OneToOneSequentialConnector" class="md-nav__link">
    <span class="md-ellipsis">
      OneToOneSequentialConnector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OneToOneSequentialConnector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.OneToOneSequentialConnector.edge_params" class="md-nav__link">
    <span class="md-ellipsis">
      edge_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.OneToOneSequentialConnector.get_nodes_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_nodes_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.OneToOneSequentialConnector.make_connection" class="md-nav__link">
    <span class="md-ellipsis">
      make_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.OneToOneSequentialConnector.setup_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      setup_nodes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapse-helper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Synapse Helper Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Synapse Helper Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.syn_const_delay" class="md-nav__link">
    <span class="md-ellipsis">
      syn_const_delay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.syn_dist_delay_feng" class="md-nav__link">
    <span class="md-ellipsis">
      syn_dist_delay_feng
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.syn_section_PN" class="md-nav__link">
    <span class="md-ellipsis">
      syn_section_PN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.syn_const_delay_feng_section_PN" class="md-nav__link">
    <span class="md-ellipsis">
      syn_const_delay_feng_section_PN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.syn_dist_delay_feng_section_PN" class="md-nav__link">
    <span class="md-ellipsis">
      syn_dist_delay_feng_section_PN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.syn_uniform_delay_section" class="md-nav__link">
    <span class="md-ellipsis">
      syn_uniform_delay_section
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    BMPlot
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            BMPlot
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bmplot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bmplot/connections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Connection Plotting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bmplot/spikes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spike Plotting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bmplot/lfp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LFP/ECP Plotting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bmplot/entrainment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entrainment Plotting
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analysis/spikes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spike Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analysis/lfp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LFP/ECP Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analysis/entrainment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entrainment Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analysis/netcon_reports/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Connectivity
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../slurm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SLURM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graphs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Graphs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Utility Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utility Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.num_prop" class="md-nav__link">
    <span class="md-ellipsis">
      num_prop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.decision" class="md-nav__link">
    <span class="md-ellipsis">
      decision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.decisions" class="md-nav__link">
    <span class="md-ellipsis">
      decisions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.euclid_dist" class="md-nav__link">
    <span class="md-ellipsis">
      euclid_dist
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.spherical_dist" class="md-nav__link">
    <span class="md-ellipsis">
      spherical_dist
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.cylindrical_dist_z" class="md-nav__link">
    <span class="md-ellipsis">
      cylindrical_dist_z
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#probability-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Probability Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Probability Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ProbabilityFunction" class="md-nav__link">
    <span class="md-ellipsis">
      ProbabilityFunction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProbabilityFunction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ProbabilityFunction.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ProbabilityFunction.decisions" class="md-nav__link">
    <span class="md-ellipsis">
      decisions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ProbabilityFunction.probability" class="md-nav__link">
    <span class="md-ellipsis">
      probability
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.DistantDependentProbability" class="md-nav__link">
    <span class="md-ellipsis">
      DistantDependentProbability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DistantDependentProbability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.DistantDependentProbability.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.DistantDependentProbability.decisions" class="md-nav__link">
    <span class="md-ellipsis">
      decisions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UniformInRange" class="md-nav__link">
    <span class="md-ellipsis">
      UniformInRange
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.gaussian" class="md-nav__link">
    <span class="md-ellipsis">
      gaussian
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.GaussianDropoff" class="md-nav__link">
    <span class="md-ellipsis">
      GaussianDropoff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GaussianDropoff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.GaussianDropoff.calc_pmax_from_ptotal" class="md-nav__link">
    <span class="md-ellipsis">
      calc_pmax_from_ptotal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.GaussianDropoff.set_probability_func" class="md-nav__link">
    <span class="md-ellipsis">
      set_probability_func
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.NormalizedReciprocalRate" class="md-nav__link">
    <span class="md-ellipsis">
      NormalizedReciprocalRate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NormalizedReciprocalRate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.NormalizedReciprocalRate.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.NormalizedReciprocalRate.decisions" class="md-nav__link">
    <span class="md-ellipsis">
      decisions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.NormalizedReciprocalRate.probability" class="md-nav__link">
    <span class="md-ellipsis">
      probability
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-base-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Connector Base Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector Base Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.AbstractConnector" class="md-nav__link">
    <span class="md-ellipsis">
      AbstractConnector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AbstractConnector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.AbstractConnector.constant_function" class="md-nav__link">
    <span class="md-ellipsis">
      constant_function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.AbstractConnector.edge_params" class="md-nav__link">
    <span class="md-ellipsis">
      edge_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.AbstractConnector.setup_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      setup_nodes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.is_same_pop" class="md-nav__link">
    <span class="md-ellipsis">
      is_same_pop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.Timer" class="md-nav__link">
    <span class="md-ellipsis">
      Timer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.pr_2_rho" class="md-nav__link">
    <span class="md-ellipsis">
      pr_2_rho
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.rho_2_pr" class="md-nav__link">
    <span class="md-ellipsis">
      rho_2_pr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-implementations" class="md-nav__link">
    <span class="md-ellipsis">
      Connector Implementations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector Implementations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector" class="md-nav__link">
    <span class="md-ellipsis">
      ReciprocalConnector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReciprocalConnector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.add_conn_prop" class="md-nav__link">
    <span class="md-ellipsis">
      add_conn_prop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.calc_pair" class="md-nav__link">
    <span class="md-ellipsis">
      calc_pair
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.connection_number" class="md-nav__link">
    <span class="md-ellipsis">
      connection_number
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.connection_number_info" class="md-nav__link">
    <span class="md-ellipsis">
      connection_number_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.edge_params" class="md-nav__link">
    <span class="md-ellipsis">
      edge_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.free_memory" class="md-nav__link">
    <span class="md-ellipsis">
      free_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.get_conn_prop" class="md-nav__link">
    <span class="md-ellipsis">
      get_conn_prop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.get_nodes_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_nodes_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.initial_all_to_all" class="md-nav__link">
    <span class="md-ellipsis">
      initial_all_to_all
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.iterate_pairs" class="md-nav__link">
    <span class="md-ellipsis">
      iterate_pairs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.make_backward_connection" class="md-nav__link">
    <span class="md-ellipsis">
      make_backward_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.make_connection" class="md-nav__link">
    <span class="md-ellipsis">
      make_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.make_forward_connection" class="md-nav__link">
    <span class="md-ellipsis">
      make_forward_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.node_2_idx_input" class="md-nav__link">
    <span class="md-ellipsis">
      node_2_idx_input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.save_connection_report" class="md-nav__link">
    <span class="md-ellipsis">
      save_connection_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.setup_conditional_backward_probability" class="md-nav__link">
    <span class="md-ellipsis">
      setup_conditional_backward_probability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.ReciprocalConnector.setup_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      setup_nodes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector" class="md-nav__link">
    <span class="md-ellipsis">
      UnidirectionConnector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UnidirectionConnector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.add_conn_prop" class="md-nav__link">
    <span class="md-ellipsis">
      add_conn_prop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.connection_number_info" class="md-nav__link">
    <span class="md-ellipsis">
      connection_number_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.edge_params" class="md-nav__link">
    <span class="md-ellipsis">
      edge_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.get_conn_prop" class="md-nav__link">
    <span class="md-ellipsis">
      get_conn_prop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.get_nodes_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_nodes_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.make_connection" class="md-nav__link">
    <span class="md-ellipsis">
      make_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.save_connection_report" class="md-nav__link">
    <span class="md-ellipsis">
      save_connection_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.setup_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      setup_nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.UnidirectionConnector.setup_variables" class="md-nav__link">
    <span class="md-ellipsis">
      setup_variables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.GapJunction" class="md-nav__link">
    <span class="md-ellipsis">
      GapJunction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GapJunction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.GapJunction.make_connection" class="md-nav__link">
    <span class="md-ellipsis">
      make_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.GapJunction.save_connection_report" class="md-nav__link">
    <span class="md-ellipsis">
      save_connection_report
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.CorrelatedGapJunction" class="md-nav__link">
    <span class="md-ellipsis">
      CorrelatedGapJunction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CorrelatedGapJunction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.CorrelatedGapJunction.make_connection" class="md-nav__link">
    <span class="md-ellipsis">
      make_connection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.OneToOneSequentialConnector" class="md-nav__link">
    <span class="md-ellipsis">
      OneToOneSequentialConnector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OneToOneSequentialConnector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.OneToOneSequentialConnector.edge_params" class="md-nav__link">
    <span class="md-ellipsis">
      edge_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.OneToOneSequentialConnector.get_nodes_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_nodes_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.OneToOneSequentialConnector.make_connection" class="md-nav__link">
    <span class="md-ellipsis">
      make_connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.OneToOneSequentialConnector.setup_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      setup_nodes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapse-helper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Synapse Helper Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Synapse Helper Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.syn_const_delay" class="md-nav__link">
    <span class="md-ellipsis">
      syn_const_delay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.syn_dist_delay_feng" class="md-nav__link">
    <span class="md-ellipsis">
      syn_dist_delay_feng
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.syn_section_PN" class="md-nav__link">
    <span class="md-ellipsis">
      syn_section_PN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.syn_const_delay_feng_section_PN" class="md-nav__link">
    <span class="md-ellipsis">
      syn_const_delay_feng_section_PN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.syn_dist_delay_feng_section_PN" class="md-nav__link">
    <span class="md-ellipsis">
      syn_dist_delay_feng_section_PN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmtool.connectors.syn_uniform_delay_section" class="md-nav__link">
    <span class="md-ellipsis">
      syn_uniform_delay_section
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="connectors-api-reference">Connectors API Reference</h1>
<p>This page provides API reference documentation for the Connectors module, which contains classes and functions for creating complex connectivity patterns in BMTK networks.</p>
<h2 id="utility-functions">Utility Functions</h2>


<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.num_prop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">num_prop</span><span class="p">(</span><span class="n">ratio</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Calculate numbers of total N in proportion to ratio.</p>


<details class="parameters:" open>
  <summary>Parameters:</summary>
  <p>ratio : array-like
    Proportions to distribute N across.
N : int
    Total number to distribute.</p>
</details>

<details class="returns:" open>
  <summary>Returns:</summary>
  <p>numpy.ndarray
    Array of integers that sum to N, proportionally distributed according to ratio.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">num_prop</span><span class="p">(</span><span class="n">ratio</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate numbers of total N in proportion to ratio.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    ratio : array-like</span>
<span class="sd">        Proportions to distribute N across.</span>
<span class="sd">    N : int</span>
<span class="sd">        Total number to distribute.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        Array of integers that sum to N, proportionally distributed according to ratio.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ratio</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># cumulative proportion</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">N</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ratio</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.decision" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">decision</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Make random decision(s) based on input probability.</p>


<details class="parameters:" open>
  <summary>Parameters:</summary>
  <p>prob : float
    Probability threshold between 0 and 1.
size : int or tuple, optional
    Size of the output array. If None, a single decision is returned.</p>
</details>

<details class="returns:" open>
  <summary>Returns:</summary>
  <p>bool or numpy.ndarray
    Boolean result(s) of the random decision(s). True if the random number
    is less than prob, False otherwise.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">decision</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make random decision(s) based on input probability.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    prob : float</span>
<span class="sd">        Probability threshold between 0 and 1.</span>
<span class="sd">    size : int or tuple, optional</span>
<span class="sd">        Size of the output array. If None, a single decision is returned.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    bool or numpy.ndarray</span>
<span class="sd">        Boolean result(s) of the random decision(s). True if the random number</span>
<span class="sd">        is less than prob, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">prob</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.decisions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">decisions</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Make multiple random decisions based on input probabilities.</p>


<details class="parameters:" open>
  <summary>Parameters:</summary>
  <p>prob : array-like
    Array of probability thresholds between 0 and 1.</p>
</details>

<details class="returns:" open>
  <summary>Returns:</summary>
  <p>numpy.ndarray
    Boolean array with the same shape as prob, containing results of
    the random decisions.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">decisions</span><span class="p">(</span><span class="n">prob</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make multiple random decisions based on input probabilities.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    prob : array-like</span>
<span class="sd">        Array of probability thresholds between 0 and 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        Boolean array with the same shape as prob, containing results of</span>
<span class="sd">        the random decisions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">prob</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">prob</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.euclid_dist" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">euclid_dist</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Euclidean distance between two points
p1, p2: Coordinates in numpy array</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">euclid_dist</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Euclidean distance between two points</span>
<span class="sd">    p1, p2: Coordinates in numpy array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">dvec</span> <span class="o">@</span> <span class="n">dvec</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.spherical_dist" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">spherical_dist</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Spherical distance between two input nodes</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">spherical_dist</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Spherical distance between two input nodes&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">euclid_dist</span><span class="p">(</span><span class="n">node1</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">],</span> <span class="n">node2</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.cylindrical_dist_z" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">cylindrical_dist_z</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Cylindircal distance between two input nodes (ignoring z-axis)</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cylindrical_dist_z</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cylindircal distance between two input nodes (ignoring z-axis)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">euclid_dist</span><span class="p">(</span><span class="n">node1</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">][:</span><span class="mi">2</span><span class="p">],</span> <span class="n">node2</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="probability-functions">Probability Functions</h2>


<div class="doc doc-object doc-class">



<h3 id="bmtool.connectors.ProbabilityFunction" class="doc doc-heading">
            <code>bmtool.connectors.ProbabilityFunction</code>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract base class for connection probability function</p>








              <details class="quote">
                <summary>Source code in <code>bmtool/connectors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProbabilityFunction</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for connection probability function&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Allow numpy array input and return probability in numpy array&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return probability within [0, 1] for single input&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">decisions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return bool array of decisions according probability&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ProbabilityFunction.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Return probability within [0, 1] for single input</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return probability within [0, 1] for single input&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ProbabilityFunction.decisions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decisions</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Return bool array of decisions according probability</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">decisions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return bool array of decisions according probability&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ProbabilityFunction.probability" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">probability</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Allow numpy array input and return probability in numpy array</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Allow numpy array input and return probability in numpy array&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="bmtool.connectors.DistantDependentProbability" class="doc doc-heading">
            <code>bmtool.connectors.DistantDependentProbability</code>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="bmtool.connectors.ProbabilityFunction" href="#bmtool.connectors.ProbabilityFunction">ProbabilityFunction</a></code></p>


        <p>Base class for distance dependent probability</p>








              <details class="quote">
                <summary>Source code in <code>bmtool/connectors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DistantDependentProbability</span><span class="p">(</span><span class="n">ProbabilityFunction</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for distance dependent probability&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">min_dist</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">min_dist</span> <span class="o">&lt;</span> <span class="n">max_dist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_dist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span> <span class="o">=</span> <span class="n">min_dist</span><span class="p">,</span> <span class="n">max_dist</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return probability for single distance input&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dist</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_dist</span> <span class="ow">and</span> <span class="n">dist</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decisions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return bool array of decisions given distance array&quot;&quot;&quot;</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">dist</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_dist</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dist</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">prob</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
        <span class="n">dec</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">decisions</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dec</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.DistantDependentProbability.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return probability for single distance input</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return probability for single distance input&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_dist</span> <span class="ow">and</span> <span class="n">dist</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.DistantDependentProbability.decisions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decisions</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return bool array of decisions given distance array</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">decisions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return bool array of decisions given distance array&quot;&quot;&quot;</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
    <span class="n">dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">dist</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_dist</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dist</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span><span class="p">)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">prob</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
    <span class="n">dec</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">decisions</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dec</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="bmtool.connectors.UniformInRange" class="doc doc-heading">
            <code>bmtool.connectors.UniformInRange</code>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="bmtool.connectors.DistantDependentProbability" href="#bmtool.connectors.DistantDependentProbability">DistantDependentProbability</a></code></p>


        <p>Constant probability within a distance range</p>








              <details class="quote">
                <summary>Source code in <code>bmtool/connectors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UniformInRange</span><span class="p">(</span><span class="n">DistantDependentProbability</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constant probability within a distance range&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">min_dist</span><span class="o">=</span><span class="n">min_dist</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="n">max_dist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mf">1.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.gaussian" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">stdev</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">pmax</span><span class="o">=</span><span class="n">NORM_COEF</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Gaussian function. Default is the PDF of standard normal distribution</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">stdev</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">pmax</span><span class="o">=</span><span class="n">NORM_COEF</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gaussian function. Default is the PDF of standard normal distribution&quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">stdev</span>
    <span class="k">return</span> <span class="n">pmax</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="bmtool.connectors.GaussianDropoff" class="doc doc-heading">
            <code>bmtool.connectors.GaussianDropoff</code>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="bmtool.connectors.DistantDependentProbability" href="#bmtool.connectors.DistantDependentProbability">DistantDependentProbability</a></code></p>


        <p>Connection probability class that follows a Gaussian function of distance.</p>
<p>This class calculates connection probabilities using a Gaussian function
of the distance between cells, with options for spherical or cylindrical metrics.</p>


<details class="parameters:" open>
  <summary>Parameters:</summary>
  <p>mean : float, optional
    Mean parameter of the Gaussian function, typically 0 for peak at origin.
stdev : float, optional
    Standard deviation parameter controlling the width of the Gaussian.
min_dist : float, optional
    Minimum distance for connections. Below this distance, probability is zero.
max_dist : float, optional
    Maximum distance for connections. Above this distance, probability is zero.
pmax : float, optional
    Maximum probability value at the peak of the Gaussian function.
ptotal : float, optional
    Overall connection probability within the specified distance range.
    If provided, pmax is calculated to achieve this overall probability.
ptotal_dist_range : tuple, optional
    Distance range (min_dist, max_dist) for calculating pmax when ptotal is provided.
dist_type : str, optional
    Distance metric to use, either 'spherical' (default) or 'cylindrical'.</p>
</details>

<details class="notes:" open>
  <summary>Notes:</summary>
  <p>When ptotal is specified, the maximum probability (pmax) is calculated to achieve
the desired overall connection probability within the specified distance range,
assuming homogeneous cell density.</p>
</details>







              <details class="quote">
                <summary>Source code in <code>bmtool/connectors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GaussianDropoff</span><span class="p">(</span><span class="n">DistantDependentProbability</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Connection probability class that follows a Gaussian function of distance.</span>

<span class="sd">    This class calculates connection probabilities using a Gaussian function</span>
<span class="sd">    of the distance between cells, with options for spherical or cylindrical metrics.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    mean : float, optional</span>
<span class="sd">        Mean parameter of the Gaussian function, typically 0 for peak at origin.</span>
<span class="sd">    stdev : float, optional</span>
<span class="sd">        Standard deviation parameter controlling the width of the Gaussian.</span>
<span class="sd">    min_dist : float, optional</span>
<span class="sd">        Minimum distance for connections. Below this distance, probability is zero.</span>
<span class="sd">    max_dist : float, optional</span>
<span class="sd">        Maximum distance for connections. Above this distance, probability is zero.</span>
<span class="sd">    pmax : float, optional</span>
<span class="sd">        Maximum probability value at the peak of the Gaussian function.</span>
<span class="sd">    ptotal : float, optional</span>
<span class="sd">        Overall connection probability within the specified distance range.</span>
<span class="sd">        If provided, pmax is calculated to achieve this overall probability.</span>
<span class="sd">    ptotal_dist_range : tuple, optional</span>
<span class="sd">        Distance range (min_dist, max_dist) for calculating pmax when ptotal is provided.</span>
<span class="sd">    dist_type : str, optional</span>
<span class="sd">        Distance metric to use, either &#39;spherical&#39; (default) or &#39;cylindrical&#39;.</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    When ptotal is specified, the maximum probability (pmax) is calculated to achieve</span>
<span class="sd">    the desired overall connection probability within the specified distance range,</span>
<span class="sd">    assuming homogeneous cell density.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">stdev</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">max_dist</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
        <span class="n">pmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">ptotal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ptotal_dist_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dist_type</span><span class="o">=</span><span class="s2">&quot;spherical&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">min_dist</span><span class="o">=</span><span class="n">min_dist</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="n">max_dist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdev</span> <span class="o">=</span> <span class="n">mean</span><span class="p">,</span> <span class="n">stdev</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ptotal</span> <span class="o">=</span> <span class="n">ptotal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ptotal_dist_range</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">min_dist</span><span class="p">,</span> <span class="n">max_dist</span><span class="p">)</span> <span class="k">if</span> <span class="n">ptotal_dist_range</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ptotal_dist_range</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_type</span> <span class="o">=</span> <span class="n">dist_type</span> <span class="k">if</span> <span class="n">dist_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cylindrical&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;spherical&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmax</span> <span class="o">=</span> <span class="n">pmax</span> <span class="k">if</span> <span class="n">ptotal</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_pmax_from_ptotal</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_probability_func</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calc_pmax_from_ptotal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the pmax value such that the expected overall connection</span>
<span class="sd">        probability to all possible targets within the distance range [r1, r2]=</span>
<span class="sd">        `ptotal_dist_range` equals ptotal, assuming homogeneous cell density.</span>
<span class="sd">        That is, integral_r1^r2 {g(r)p(r)dr} = ptotal, where g is the Gaussian</span>
<span class="sd">        function with pmax, p(r) is the cell density per unit distance at r</span>
<span class="sd">        normalized by total cell number within the distance range.</span>
<span class="sd">        For cylindrical distance, p(r) = 2 * r / (r2^2 - r1^2)</span>
<span class="sd">        For spherical distance, p(r) = 3 * r^2 / (r2^3 - r1^3)</span>
<span class="sd">        The solution has a closed form except that te error function erf is in</span>
<span class="sd">        the expression, but only when resulting pmax &lt;= 1.</span>

<span class="sd">        Caveat: When the calculated pmax &gt; 1, the actual overall probability</span>
<span class="sd">        will be lower than expected and all cells within certain distance will</span>
<span class="sd">        be always connected. This usually happens when the distance range is</span>
<span class="sd">        set too wide. Because a large population will be included for</span>
<span class="sd">        evaluating ptotal, and there will be a significant drop in the Gaussian</span>
<span class="sd">        function as distance gets further. So, a large pmax will be required to</span>
<span class="sd">        achieve the desired ptotal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdev</span>
        <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptotal_dist_range</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">r1</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sig</span><span class="p">,</span> <span class="p">(</span><span class="n">r2</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sig</span>  <span class="c1"># normalized distance</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_type</span> <span class="o">==</span> <span class="s2">&quot;cylindrical&quot;</span><span class="p">:</span>
            <span class="n">dr</span> <span class="o">=</span> <span class="n">r2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">r1</span><span class="o">**</span><span class="mi">2</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">F</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">f1</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">/</span> <span class="n">NORM_COEF</span> <span class="o">*</span> <span class="n">erf</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">f2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">f1</span> <span class="o">+</span> <span class="n">f2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dr</span> <span class="o">=</span> <span class="n">r2</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">r1</span><span class="o">**</span><span class="mi">3</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">F</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">f1</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">*</span> <span class="p">(</span><span class="n">sig</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">NORM_COEF</span> <span class="o">*</span> <span class="n">erf</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">f2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">f1</span> <span class="o">+</span> <span class="n">f2</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptotal</span> <span class="o">*</span> <span class="n">dr</span> <span class="o">/</span> <span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="p">(</span><span class="n">x1</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>  <span class="c1"># to be set up in set_probability_func()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_probability_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up function for calculating probability&quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;stdev&quot;</span><span class="p">,</span> <span class="s2">&quot;pmax&quot;</span><span class="p">]</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">}</span>
        <span class="n">probability</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">gaussian</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Verify maximum probability</span>
        <span class="c1"># (is not self.pmax if self.mean outside distance range)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_dist</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">))</span>
        <span class="n">pmax</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pmax</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span> <span class="n">probability</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">bounds</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">pmax</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">probability</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bounded&quot;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span>
            <span class="p">)</span><span class="o">.</span><span class="n">x</span>
            <span class="n">warn</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning: Maximum probability=</span><span class="si">%.3f</span><span class="s2"> is greater than 1. &quot;</span>
                <span class="s2">&quot;Probability crosses 1 at distance </span><span class="si">%.3g</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">pmax</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptotal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">warn</span> <span class="o">+=</span> <span class="s2">&quot; ptotal may not be reached.&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">warn</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">probability</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">dist</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="n">probability</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">probability</span> <span class="o">=</span> <span class="n">probability</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.GaussianDropoff.calc_pmax_from_ptotal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calc_pmax_from_ptotal</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate the pmax value such that the expected overall connection
probability to all possible targets within the distance range [r1, r2]=
<code>ptotal_dist_range</code> equals ptotal, assuming homogeneous cell density.
That is, integral_r1^r2 {g(r)p(r)dr} = ptotal, where g is the Gaussian
function with pmax, p(r) is the cell density per unit distance at r
normalized by total cell number within the distance range.
For cylindrical distance, p(r) = 2 * r / (r2^2 - r1^2)
For spherical distance, p(r) = 3 * r^2 / (r2^3 - r1^3)
The solution has a closed form except that te error function erf is in
the expression, but only when resulting pmax &lt;= 1.</p>
<p>Caveat: When the calculated pmax &gt; 1, the actual overall probability
will be lower than expected and all cells within certain distance will
be always connected. This usually happens when the distance range is
set too wide. Because a large population will be included for
evaluating ptotal, and there will be a significant drop in the Gaussian
function as distance gets further. So, a large pmax will be required to
achieve the desired ptotal.</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calc_pmax_from_ptotal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the pmax value such that the expected overall connection</span>
<span class="sd">    probability to all possible targets within the distance range [r1, r2]=</span>
<span class="sd">    `ptotal_dist_range` equals ptotal, assuming homogeneous cell density.</span>
<span class="sd">    That is, integral_r1^r2 {g(r)p(r)dr} = ptotal, where g is the Gaussian</span>
<span class="sd">    function with pmax, p(r) is the cell density per unit distance at r</span>
<span class="sd">    normalized by total cell number within the distance range.</span>
<span class="sd">    For cylindrical distance, p(r) = 2 * r / (r2^2 - r1^2)</span>
<span class="sd">    For spherical distance, p(r) = 3 * r^2 / (r2^3 - r1^3)</span>
<span class="sd">    The solution has a closed form except that te error function erf is in</span>
<span class="sd">    the expression, but only when resulting pmax &lt;= 1.</span>

<span class="sd">    Caveat: When the calculated pmax &gt; 1, the actual overall probability</span>
<span class="sd">    will be lower than expected and all cells within certain distance will</span>
<span class="sd">    be always connected. This usually happens when the distance range is</span>
<span class="sd">    set too wide. Because a large population will be included for</span>
<span class="sd">    evaluating ptotal, and there will be a significant drop in the Gaussian</span>
<span class="sd">    function as distance gets further. So, a large pmax will be required to</span>
<span class="sd">    achieve the desired ptotal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mu</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdev</span>
    <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptotal_dist_range</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">r1</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sig</span><span class="p">,</span> <span class="p">(</span><span class="n">r2</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sig</span>  <span class="c1"># normalized distance</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_type</span> <span class="o">==</span> <span class="s2">&quot;cylindrical&quot;</span><span class="p">:</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">r2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">r1</span><span class="o">**</span><span class="mi">2</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">F</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">f1</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">/</span> <span class="n">NORM_COEF</span> <span class="o">*</span> <span class="n">erf</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f1</span> <span class="o">+</span> <span class="n">f2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">r2</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">r1</span><span class="o">**</span><span class="mi">3</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">F</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">f1</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">*</span> <span class="p">(</span><span class="n">sig</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">NORM_COEF</span> <span class="o">*</span> <span class="n">erf</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f1</span> <span class="o">+</span> <span class="n">f2</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptotal</span> <span class="o">*</span> <span class="n">dr</span> <span class="o">/</span> <span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="p">(</span><span class="n">x1</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.GaussianDropoff.set_probability_func" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_probability_func</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Set up function for calculating probability</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_probability_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up function for calculating probability&quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;stdev&quot;</span><span class="p">,</span> <span class="s2">&quot;pmax&quot;</span><span class="p">]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">}</span>
    <span class="n">probability</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">gaussian</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Verify maximum probability</span>
    <span class="c1"># (is not self.pmax if self.mean outside distance range)</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_dist</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_dist</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">))</span>
    <span class="n">pmax</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmax</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span> <span class="n">probability</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">bounds</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">pmax</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">probability</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bounded&quot;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span>
        <span class="p">)</span><span class="o">.</span><span class="n">x</span>
        <span class="n">warn</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning: Maximum probability=</span><span class="si">%.3f</span><span class="s2"> is greater than 1. &quot;</span>
            <span class="s2">&quot;Probability crosses 1 at distance </span><span class="si">%.3g</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">pmax</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptotal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warn</span> <span class="o">+=</span> <span class="s2">&quot; ptotal may not be reached.&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">warn</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probability</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">dist</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="n">probability</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probability</span> <span class="o">=</span> <span class="n">probability</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="bmtool.connectors.NormalizedReciprocalRate" class="doc doc-heading">
            <code>bmtool.connectors.NormalizedReciprocalRate</code>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="bmtool.connectors.ProbabilityFunction" href="#bmtool.connectors.ProbabilityFunction">ProbabilityFunction</a></code></p>


        <p>Reciprocal connection probability given normalized reciprocal rate.
Normalized reciprocal rate is defined as the ratio between the reciprocal
connection probability and the connection probability for a randomly
connected network where the two unidirectional connections between any pair
of neurons are independent. NRR = pr / (p0 * p1)</p>
<p>Parameters:
    NRR: a constant or distance dependent function for normalized reciprocal
        rate. When being a function, it should be accept vectorized input.
Returns:
    A callable object that returns the probability value.</p>








              <details class="quote">
                <summary>Source code in <code>bmtool/connectors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NormalizedReciprocalRate</span><span class="p">(</span><span class="n">ProbabilityFunction</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reciprocal connection probability given normalized reciprocal rate.</span>
<span class="sd">    Normalized reciprocal rate is defined as the ratio between the reciprocal</span>
<span class="sd">    connection probability and the connection probability for a randomly</span>
<span class="sd">    connected network where the two unidirectional connections between any pair</span>
<span class="sd">    of neurons are independent. NRR = pr / (p0 * p1)</span>

<span class="sd">    Parameters:</span>
<span class="sd">        NRR: a constant or distance dependent function for normalized reciprocal</span>
<span class="sd">            rate. When being a function, it should be accept vectorized input.</span>
<span class="sd">    Returns:</span>
<span class="sd">        A callable object that returns the probability value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NRR</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NRR</span> <span class="o">=</span> <span class="n">NRR</span> <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">NRR</span><span class="p">)</span> <span class="k">else</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">x</span><span class="p">:</span> <span class="n">NRR</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Allow numpy array input and return probability in numpy array&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">p0</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">NRR</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return probability for single distance input&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decisions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">cond</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return bool array of decisions</span>
<span class="sd">        dist: distance (scalar or array). Will be ignored if NRR is constant.</span>
<span class="sd">        p0, p1: forward and backward probability (scalar or array)</span>
<span class="sd">        cond: A tuple (direction, array of outcomes) representing the condition.</span>
<span class="sd">            Conditional probability will be returned if specified. The condition</span>
<span class="sd">            event is determined by connection direction (0 for forward, or 1 for</span>
<span class="sd">            backward) and outcomes (bool array of whether connection exists).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">,</span> <span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">))</span>
        <span class="n">pr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">pr</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
        <span class="n">pr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span><span class="n">p0</span> <span class="o">+</span> <span class="n">p1</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">a_max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">cond</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cond</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">pr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">/=</span> <span class="n">p1</span> <span class="k">if</span> <span class="n">cond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="n">p0</span>
            <span class="n">pr</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">decisions</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.NormalizedReciprocalRate.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return probability for single distance input</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return probability for single distance input&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.NormalizedReciprocalRate.decisions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decisions</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">cond</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return bool array of decisions
dist: distance (scalar or array). Will be ignored if NRR is constant.
p0, p1: forward and backward probability (scalar or array)
cond: A tuple (direction, array of outcomes) representing the condition.
    Conditional probability will be returned if specified. The condition
    event is determined by connection direction (0 for forward, or 1 for
    backward) and outcomes (bool array of whether connection exists).</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">decisions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">cond</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return bool array of decisions</span>
<span class="sd">    dist: distance (scalar or array). Will be ignored if NRR is constant.</span>
<span class="sd">    p0, p1: forward and backward probability (scalar or array)</span>
<span class="sd">    cond: A tuple (direction, array of outcomes) representing the condition.</span>
<span class="sd">        Conditional probability will be returned if specified. The condition</span>
<span class="sd">        event is determined by connection direction (0 for forward, or 1 for</span>
<span class="sd">        backward) and outcomes (bool array of whether connection exists).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">,</span> <span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">))</span>
    <span class="n">pr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">pr</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
    <span class="n">pr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span><span class="n">p0</span> <span class="o">+</span> <span class="n">p1</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">a_max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">cond</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cond</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">pr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">/=</span> <span class="n">p1</span> <span class="k">if</span> <span class="n">cond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="n">p0</span>
        <span class="n">pr</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">decisions</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.NormalizedReciprocalRate.probability" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">probability</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Allow numpy array input and return probability in numpy array</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Allow numpy array input and return probability in numpy array&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">p0</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">NRR</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="connector-base-classes">Connector Base Classes</h2>


<div class="doc doc-object doc-class">



<h3 id="bmtool.connectors.AbstractConnector" class="doc doc-heading">
            <code>bmtool.connectors.AbstractConnector</code>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract base class for connectors</p>








              <details class="quote">
                <summary>Source code in <code>bmtool/connectors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbstractConnector</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for connectors&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;After network nodes are added to the BMTK network. Pass in the</span>
<span class="sd">        Nodepool objects of source and target nodes using this method.</span>
<span class="sd">        Must run this before building connections.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">edge_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the arguments for BMTK add_edges() method including the</span>
<span class="sd">        `connection_rule` method.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">constant_function</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a constant to a constant function&quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">constant</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">val</span>

        <span class="k">return</span> <span class="n">constant</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.AbstractConnector.constant_function" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">constant_function</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Convert a constant to a constant function</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">constant_function</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a constant to a constant function&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">constant</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">return</span> <span class="n">constant</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.AbstractConnector.edge_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edge_params</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Create the arguments for BMTK add_edges() method including the
<code>connection_rule</code> method.</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">edge_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the arguments for BMTK add_edges() method including the</span>
<span class="sd">    `connection_rule` method.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.AbstractConnector.setup_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_nodes</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>After network nodes are added to the BMTK network. Pass in the
Nodepool objects of source and target nodes using this method.
Must run this before building connections.</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">setup_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;After network nodes are added to the BMTK network. Pass in the</span>
<span class="sd">    Nodepool objects of source and target nodes using this method.</span>
<span class="sd">    Must run this before building connections.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.is_same_pop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">is_same_pop</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">quick</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Check whether two NodePool objects direct to the same population</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_same_pop</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">quick</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check whether two NodePool objects direct to the same population&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">quick</span><span class="p">:</span>
        <span class="c1"># Quick check (compare filter conditions)</span>
        <span class="n">same</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">source</span><span class="o">.</span><span class="n">network_name</span> <span class="o">==</span> <span class="n">target</span><span class="o">.</span><span class="n">network_name</span>
            <span class="ow">and</span> <span class="n">source</span><span class="o">.</span><span class="n">_NodePool__properties</span> <span class="o">==</span> <span class="n">target</span><span class="o">.</span><span class="n">_NodePool__properties</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Strict check (compare all nodes)</span>
        <span class="n">same</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">source</span><span class="o">.</span><span class="n">network_name</span> <span class="o">==</span> <span class="n">target</span><span class="o">.</span><span class="n">network_name</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">node_id</span> <span class="o">==</span> <span class="n">t</span><span class="o">.</span><span class="n">node_id</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)])</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">same</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="bmtool.connectors.Timer" class="doc doc-heading">
            <code>bmtool.connectors.Timer</code>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>









              <details class="quote">
                <summary>Source code in <code>bmtool/connectors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Timer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;sec&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;ms&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mf">1e3</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;us&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mf">1e6</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">60</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;sec&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Run time&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">((</span><span class="n">msg</span> <span class="o">+</span> <span class="s2">&quot;: </span><span class="si">%.3f</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.pr_2_rho" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">pr_2_rho</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pr</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Calculate correlation coefficient rho given reciprocal probability pr</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pr_2_rho</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate correlation coefficient rho given reciprocal probability pr&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="n">pr</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">pr</span> <span class="o">&lt;=</span> <span class="n">p0</span> <span class="ow">and</span> <span class="n">pr</span> <span class="o">&lt;=</span> <span class="n">p1</span> <span class="ow">and</span> <span class="n">pr</span> <span class="o">&gt;=</span> <span class="n">p0</span> <span class="o">+</span> <span class="n">p1</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">pr</span> <span class="o">-</span> <span class="n">p0</span> <span class="o">*</span> <span class="n">p1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">)</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p1</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.rho_2_pr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">rho_2_pr</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Calculate reciprocal probability pr given correlation coefficient rho</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rho_2_pr</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate reciprocal probability pr given correlation coefficient rho&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span>
    <span class="n">pr</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">rho</span> <span class="o">*</span> <span class="p">(</span><span class="n">p0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">)</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p1</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pr</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">pr</span> <span class="o">&lt;=</span> <span class="n">p0</span> <span class="ow">and</span> <span class="n">pr</span> <span class="o">&lt;=</span> <span class="n">p1</span> <span class="ow">and</span> <span class="n">pr</span> <span class="o">&gt;=</span> <span class="n">p0</span> <span class="o">+</span> <span class="n">p1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">pr0</span><span class="p">,</span> <span class="n">pr</span> <span class="o">=</span> <span class="n">pr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span> <span class="o">+</span> <span class="n">p1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pr</span><span class="p">))))</span>
        <span class="n">rho0</span><span class="p">,</span> <span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span><span class="p">,</span> <span class="p">(</span><span class="n">pr</span> <span class="o">-</span> <span class="n">p0</span> <span class="o">*</span> <span class="n">p1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">)</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p1</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;rho changed from </span><span class="si">%.3f</span><span class="s2"> to </span><span class="si">%.3f</span><span class="s2">; pr changed from </span><span class="si">%.3f</span><span class="s2"> to </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">pr0</span><span class="p">,</span> <span class="n">pr</span><span class="p">),</span>
            <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">pr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="connector-implementations">Connector Implementations</h2>


<div class="doc doc-object doc-class">



<h3 id="bmtool.connectors.ReciprocalConnector" class="doc doc-heading">
            <code>bmtool.connectors.ReciprocalConnector</code>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="bmtool.connectors.AbstractConnector" href="#bmtool.connectors.AbstractConnector">AbstractConnector</a></code></p>


        <p>Object for buiilding connections in bmtk network model with reciprocal
probability within a single population (or between two populations).</p>
<p>Algorithm:
    Create random connection for every pair of cells independently,
    following a bivariate Bernoulli distribution. Each variable is 0 or 1,
    whether a connection exists in a forward or backward direction. There
    are four possible outcomes for each pair, no connection, unidirectional
    connection in two ways, and reciprocal connection. The probability of
    each outcome forms a contingency table.
        b a c k w a r d
    f   ---------------
    o  |   |  0  |  1  |  The total forward connection probability is
    r  |---|-----|-----|  p0 = p10 + p11
    w  | 0 | p00 | p01 |  The total backward connection probability is
    a  |---|-----|-----|  p1 = p01 + p11
    r  | 1 | p10 | p11 |  The reciprocal connection probability is
    d   ---------------   pr = p11
    The distribution can be characterized by three parameters, p0, p1, pr.
    pr = p0 * p1 when two directions are independent. The correlation
    coefficient rho between the two has a relation with pr as follow.
    rho = (pr-p0<em>p1) / (p0</em>(1-p0)<em>p1</em>(1-p1))^(1/2)
    Generating random outcome consists of two steps. First draw random
    outcome for forward connection with probability p0. Then draw backward
    outcome following a conditional probability given the forward outcome,
    represented by p0, p1, and either pr or rho.</p>
<p>Use with BMTK:
    1. Create this object with parameters.</p>
<div class="highlight"><pre><span></span><code>    connector = ReciprocalConnector(**parameters)

2. After network nodes are added to the BMTK network. Pass in the
Nodepool objects of source and target nodes using setup_nodes() method.

    source = net.nodes(**source_filter)
    target = net.nodes(**target_filter)
    connector.setup_nodes(source, target)

3. Use edge_params() method to get the arguments for BMTK add_edges()
method including the `connection_rule` method.

    net.add_edges(**connector.edge_params(),
                  **other_source_to_target_edge_properties)

If the source and target are two different populations, do this again
for the backward connections (from target to source population).

    net.add_edges(**connector.edge_params(),
                  **other_target_to_source_edge_properties)

4. When executing net.build(), BMTK uses built-in `one_to_all` iterator
that calls the make_forward_connection() method to build connections
from source to target. If the two are different populations,
`all_to_one` iterator that calls the make_backward_connection() method
is then used to build connections from target to source.
During the initial iteration when make_forward_connection() is called,
the algorithm is run to generate a connection matrix for both forward
and backward connections. In the iterations afterward, it&#39;s only
assigning the generated connections in BMTK.
</code></pre></div>
<p>Parameters:
    p0, p1: Probability of forward and backward connection. It can be a
        constant or a deterministic function whose value must be within
        range [0, 1], otherwise incorrect value may occur in the algorithm.
        When p0, p1 are constant, the connection is homogenous.
    symmetric_p1: Whether p0 and p1 are identical. When the probabilities
        are equal for forward and backward connections, set this to True,
        Argument p1 will be ignored. This is forced to be True when the
        population is recurrent, i.e., the source and target are the same.
        This is forced to be False if symmetric_p1_arg is False.
    p0_arg, p1_arg: Input argument(s) for p0 and p1 function, e.g.,
        p0(p0_arg). It can be a constant or a deterministic function whose
        input arguments are two node objects in BMTK, e.g.,
        p0_arg(src_node,trg_node), p1_arg(trg_node,src_node). The latter
        has reversed order since it's for backward connection. They are
        usually distance between two nodes which is used for distance
        dependent connection probability, where the order does not matter.
        When p0 and p1 does not need inputs arguments, set p0_arg and
        p1_arg to None as so by default. Functions p0 and p1 need to accept
        one unused positional argument as placeholder, e.g., p0(<em>args), so
        it does not raise an error when p0(None) is called.
    symmetric_p1_arg: Whether p0_arg and p1_arg are identical. If this is
        set to True, argument p1_arg will be ignored. This is forced to be
        True when the population is recurrent.
    pr, pr_arg: Probability of reciprocal connection and its first input
        argument when it is a function, similar to p0, p0_arg, p1, p1_arg.
        It can be a function when it has an explicit relation with some node
        properties such as distance. A function pr requires two additional
        positional arguments p0 and p1 even if they are not used, i.e.,
        pr(pr_arg, p0, p1), just in case pr is dependent on p0 and p1, e.g.,
        when normalized reciprocal rate NRR = pr/(p0</em>p1) is given.
        When pr_arg is a string, the same value as p1_arg will be used for
        pr_arg if the string contains '1', e.g., '1', 'p1'. Otherwise, e.g.,
        '', '0', 'p0', p0_arg will be used for pr_arg. Specifying this can
        avoid recomputing pr_arg when it's given by p0_arg or p1_arg.
    estimate_rho: Whether estimate rho that result in an overall pr. This
        is forced to be False if pr is a function or if rho is specified.
        To estimate rho, all the pairs with possible connections, meaning
        p0 and p1 are both non-zero for these pairs, are used to estimate
        a value of rho that will result in an expected number of reciprocal
        connections with the given pr. Note that pr is not over all pairs
        of source and target cells but only those has a chance to connect,
        e.g., for only pair of cells within some distance range. The
        estimation is done before generating random connections. The values
        of p0, p0_arg, p1, p1_arg can be cached during estimation of rho
        and retrieved when generating random connections for performance.
    dist_range_forward: If specified, when estimating rho, consider only
        cell pairs whose distance (p0_arg) is within the specified range.
    dist_range_backward: Similar to dist_range_forward but consider
        backward distance range (p1_arg) instead. If both are specified,
        consider only cell pairs whose both distances are within range. If
        neither is specified, infer valid pairs by non-zero connection
        probability.
    rho: The correlation coefficient rho. When specified, do not estimate
        it but instead use the given value throughout, pr will not be used.
        In cases where both p0 and p1 are simple functions, i.e., are
        constant on their support, e.g., function UniformInRange(), the
        estimation of rho will be equal to pr_2_rho(p0, p1, pr) where p0,
        p1 are non-zero. Estimation is not necessary. Directly set rho.
    n_syn0, n_syn1: Number of synapses in the forward and backward
        connection if connected. It can be a constant or a (deterministic
        or random) function whose input arguments are two node objects in
        BMTK like p0_arg, p1_arg. n_syn1 is force to be the same as n_syn0
        when the population is recurrent. Warning: The number must not be
        greater than 255 since it will be converted to uint8 when written
        into the connection matrix to reduce memory consumption.
    autapses: Whether to allow connecting a cell to itself. Default: False.
        This is ignored when the population is not recurrent.
    quick_pop_check: Whether to use quick method to check if source and
        target populations are the same. Default: False.
        Quick method checks only whether filter conditions match.
        Strict method checks whether all node id's match considering order.
    cache_data: Whether to cache the values of p0, p0_arg, p1, p1_arg
        during estimation of rho. This improves performance when
        estimate_rho is True while not creating a significant overhead in
        the opposite case. However, it requires large memory allocation
        as the population size grows. Set it to False if there is a memory
        issue.
    verbose: Whether show verbose information in console.</p>
<p>Returns:
    An object that works with BMTK to build edges in a network.</p>
<p>Important attributes:
    vars: Dictionary that stores part of the original input parameters.
    source, target: NodePool objects for the source and target populations.
    recurrent: Whether the source and target populations are the same.
    callable_set: Set of arguments that are functions but not constants.
    cache: ConnectorCache object for caching data.
    conn_mat: Connection matrix
    stage: Indicator of stage. 0 for forward and 1 for backward connection.
    conn_prop: List of two dictionaries that stores properties of connected
        pairs, for forward and backward connections respectively. In each
        dictionary, each key is the source node id and the value is a
        dictionary, where each key is the target node id that the source
        node connects to, and the value is the value of p0_arg or p1_arg.
        Example: [{sid0: {tid0: p0_arg0, tid1: p0_arg1, ...},
                   sid1: {...}, sid2: {...}, ... },
                  {tid2: {sid3: p1_arg0, sid4: p1_arg1, ...},
                   tid3: {...}, tid4: {...}, ... }]
        This is useful when properties of edges such as distance is used to
        determine other edge properties such as delay. So the distance does
        not need to be calculated repeatedly. The connector can be passed
        as an argument for the functions that generates additional edge
        properties, so that they can access the information here.</p>








              <details class="quote">
                <summary>Source code in <code>bmtool/connectors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ReciprocalConnector</span><span class="p">(</span><span class="n">AbstractConnector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object for buiilding connections in bmtk network model with reciprocal</span>
<span class="sd">    probability within a single population (or between two populations).</span>

<span class="sd">    Algorithm:</span>
<span class="sd">        Create random connection for every pair of cells independently,</span>
<span class="sd">        following a bivariate Bernoulli distribution. Each variable is 0 or 1,</span>
<span class="sd">        whether a connection exists in a forward or backward direction. There</span>
<span class="sd">        are four possible outcomes for each pair, no connection, unidirectional</span>
<span class="sd">        connection in two ways, and reciprocal connection. The probability of</span>
<span class="sd">        each outcome forms a contingency table.</span>
<span class="sd">            b a c k w a r d</span>
<span class="sd">        f   ---------------</span>
<span class="sd">        o  |   |  0  |  1  |  The total forward connection probability is</span>
<span class="sd">        r  |---|-----|-----|  p0 = p10 + p11</span>
<span class="sd">        w  | 0 | p00 | p01 |  The total backward connection probability is</span>
<span class="sd">        a  |---|-----|-----|  p1 = p01 + p11</span>
<span class="sd">        r  | 1 | p10 | p11 |  The reciprocal connection probability is</span>
<span class="sd">        d   ---------------   pr = p11</span>
<span class="sd">        The distribution can be characterized by three parameters, p0, p1, pr.</span>
<span class="sd">        pr = p0 * p1 when two directions are independent. The correlation</span>
<span class="sd">        coefficient rho between the two has a relation with pr as follow.</span>
<span class="sd">        rho = (pr-p0*p1) / (p0*(1-p0)*p1*(1-p1))^(1/2)</span>
<span class="sd">        Generating random outcome consists of two steps. First draw random</span>
<span class="sd">        outcome for forward connection with probability p0. Then draw backward</span>
<span class="sd">        outcome following a conditional probability given the forward outcome,</span>
<span class="sd">        represented by p0, p1, and either pr or rho.</span>

<span class="sd">    Use with BMTK:</span>
<span class="sd">        1. Create this object with parameters.</span>

<span class="sd">            connector = ReciprocalConnector(**parameters)</span>

<span class="sd">        2. After network nodes are added to the BMTK network. Pass in the</span>
<span class="sd">        Nodepool objects of source and target nodes using setup_nodes() method.</span>

<span class="sd">            source = net.nodes(**source_filter)</span>
<span class="sd">            target = net.nodes(**target_filter)</span>
<span class="sd">            connector.setup_nodes(source, target)</span>

<span class="sd">        3. Use edge_params() method to get the arguments for BMTK add_edges()</span>
<span class="sd">        method including the `connection_rule` method.</span>

<span class="sd">            net.add_edges(**connector.edge_params(),</span>
<span class="sd">                          **other_source_to_target_edge_properties)</span>

<span class="sd">        If the source and target are two different populations, do this again</span>
<span class="sd">        for the backward connections (from target to source population).</span>

<span class="sd">            net.add_edges(**connector.edge_params(),</span>
<span class="sd">                          **other_target_to_source_edge_properties)</span>

<span class="sd">        4. When executing net.build(), BMTK uses built-in `one_to_all` iterator</span>
<span class="sd">        that calls the make_forward_connection() method to build connections</span>
<span class="sd">        from source to target. If the two are different populations,</span>
<span class="sd">        `all_to_one` iterator that calls the make_backward_connection() method</span>
<span class="sd">        is then used to build connections from target to source.</span>
<span class="sd">        During the initial iteration when make_forward_connection() is called,</span>
<span class="sd">        the algorithm is run to generate a connection matrix for both forward</span>
<span class="sd">        and backward connections. In the iterations afterward, it&#39;s only</span>
<span class="sd">        assigning the generated connections in BMTK.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        p0, p1: Probability of forward and backward connection. It can be a</span>
<span class="sd">            constant or a deterministic function whose value must be within</span>
<span class="sd">            range [0, 1], otherwise incorrect value may occur in the algorithm.</span>
<span class="sd">            When p0, p1 are constant, the connection is homogenous.</span>
<span class="sd">        symmetric_p1: Whether p0 and p1 are identical. When the probabilities</span>
<span class="sd">            are equal for forward and backward connections, set this to True,</span>
<span class="sd">            Argument p1 will be ignored. This is forced to be True when the</span>
<span class="sd">            population is recurrent, i.e., the source and target are the same.</span>
<span class="sd">            This is forced to be False if symmetric_p1_arg is False.</span>
<span class="sd">        p0_arg, p1_arg: Input argument(s) for p0 and p1 function, e.g.,</span>
<span class="sd">            p0(p0_arg). It can be a constant or a deterministic function whose</span>
<span class="sd">            input arguments are two node objects in BMTK, e.g.,</span>
<span class="sd">            p0_arg(src_node,trg_node), p1_arg(trg_node,src_node). The latter</span>
<span class="sd">            has reversed order since it&#39;s for backward connection. They are</span>
<span class="sd">            usually distance between two nodes which is used for distance</span>
<span class="sd">            dependent connection probability, where the order does not matter.</span>
<span class="sd">            When p0 and p1 does not need inputs arguments, set p0_arg and</span>
<span class="sd">            p1_arg to None as so by default. Functions p0 and p1 need to accept</span>
<span class="sd">            one unused positional argument as placeholder, e.g., p0(*args), so</span>
<span class="sd">            it does not raise an error when p0(None) is called.</span>
<span class="sd">        symmetric_p1_arg: Whether p0_arg and p1_arg are identical. If this is</span>
<span class="sd">            set to True, argument p1_arg will be ignored. This is forced to be</span>
<span class="sd">            True when the population is recurrent.</span>
<span class="sd">        pr, pr_arg: Probability of reciprocal connection and its first input</span>
<span class="sd">            argument when it is a function, similar to p0, p0_arg, p1, p1_arg.</span>
<span class="sd">            It can be a function when it has an explicit relation with some node</span>
<span class="sd">            properties such as distance. A function pr requires two additional</span>
<span class="sd">            positional arguments p0 and p1 even if they are not used, i.e.,</span>
<span class="sd">            pr(pr_arg, p0, p1), just in case pr is dependent on p0 and p1, e.g.,</span>
<span class="sd">            when normalized reciprocal rate NRR = pr/(p0*p1) is given.</span>
<span class="sd">            When pr_arg is a string, the same value as p1_arg will be used for</span>
<span class="sd">            pr_arg if the string contains &#39;1&#39;, e.g., &#39;1&#39;, &#39;p1&#39;. Otherwise, e.g.,</span>
<span class="sd">            &#39;&#39;, &#39;0&#39;, &#39;p0&#39;, p0_arg will be used for pr_arg. Specifying this can</span>
<span class="sd">            avoid recomputing pr_arg when it&#39;s given by p0_arg or p1_arg.</span>
<span class="sd">        estimate_rho: Whether estimate rho that result in an overall pr. This</span>
<span class="sd">            is forced to be False if pr is a function or if rho is specified.</span>
<span class="sd">            To estimate rho, all the pairs with possible connections, meaning</span>
<span class="sd">            p0 and p1 are both non-zero for these pairs, are used to estimate</span>
<span class="sd">            a value of rho that will result in an expected number of reciprocal</span>
<span class="sd">            connections with the given pr. Note that pr is not over all pairs</span>
<span class="sd">            of source and target cells but only those has a chance to connect,</span>
<span class="sd">            e.g., for only pair of cells within some distance range. The</span>
<span class="sd">            estimation is done before generating random connections. The values</span>
<span class="sd">            of p0, p0_arg, p1, p1_arg can be cached during estimation of rho</span>
<span class="sd">            and retrieved when generating random connections for performance.</span>
<span class="sd">        dist_range_forward: If specified, when estimating rho, consider only</span>
<span class="sd">            cell pairs whose distance (p0_arg) is within the specified range.</span>
<span class="sd">        dist_range_backward: Similar to dist_range_forward but consider</span>
<span class="sd">            backward distance range (p1_arg) instead. If both are specified,</span>
<span class="sd">            consider only cell pairs whose both distances are within range. If</span>
<span class="sd">            neither is specified, infer valid pairs by non-zero connection</span>
<span class="sd">            probability.</span>
<span class="sd">        rho: The correlation coefficient rho. When specified, do not estimate</span>
<span class="sd">            it but instead use the given value throughout, pr will not be used.</span>
<span class="sd">            In cases where both p0 and p1 are simple functions, i.e., are</span>
<span class="sd">            constant on their support, e.g., function UniformInRange(), the</span>
<span class="sd">            estimation of rho will be equal to pr_2_rho(p0, p1, pr) where p0,</span>
<span class="sd">            p1 are non-zero. Estimation is not necessary. Directly set rho.</span>
<span class="sd">        n_syn0, n_syn1: Number of synapses in the forward and backward</span>
<span class="sd">            connection if connected. It can be a constant or a (deterministic</span>
<span class="sd">            or random) function whose input arguments are two node objects in</span>
<span class="sd">            BMTK like p0_arg, p1_arg. n_syn1 is force to be the same as n_syn0</span>
<span class="sd">            when the population is recurrent. Warning: The number must not be</span>
<span class="sd">            greater than 255 since it will be converted to uint8 when written</span>
<span class="sd">            into the connection matrix to reduce memory consumption.</span>
<span class="sd">        autapses: Whether to allow connecting a cell to itself. Default: False.</span>
<span class="sd">            This is ignored when the population is not recurrent.</span>
<span class="sd">        quick_pop_check: Whether to use quick method to check if source and</span>
<span class="sd">            target populations are the same. Default: False.</span>
<span class="sd">            Quick method checks only whether filter conditions match.</span>
<span class="sd">            Strict method checks whether all node id&#39;s match considering order.</span>
<span class="sd">        cache_data: Whether to cache the values of p0, p0_arg, p1, p1_arg</span>
<span class="sd">            during estimation of rho. This improves performance when</span>
<span class="sd">            estimate_rho is True while not creating a significant overhead in</span>
<span class="sd">            the opposite case. However, it requires large memory allocation</span>
<span class="sd">            as the population size grows. Set it to False if there is a memory</span>
<span class="sd">            issue.</span>
<span class="sd">        verbose: Whether show verbose information in console.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An object that works with BMTK to build edges in a network.</span>

<span class="sd">    Important attributes:</span>
<span class="sd">        vars: Dictionary that stores part of the original input parameters.</span>
<span class="sd">        source, target: NodePool objects for the source and target populations.</span>
<span class="sd">        recurrent: Whether the source and target populations are the same.</span>
<span class="sd">        callable_set: Set of arguments that are functions but not constants.</span>
<span class="sd">        cache: ConnectorCache object for caching data.</span>
<span class="sd">        conn_mat: Connection matrix</span>
<span class="sd">        stage: Indicator of stage. 0 for forward and 1 for backward connection.</span>
<span class="sd">        conn_prop: List of two dictionaries that stores properties of connected</span>
<span class="sd">            pairs, for forward and backward connections respectively. In each</span>
<span class="sd">            dictionary, each key is the source node id and the value is a</span>
<span class="sd">            dictionary, where each key is the target node id that the source</span>
<span class="sd">            node connects to, and the value is the value of p0_arg or p1_arg.</span>
<span class="sd">            Example: [{sid0: {tid0: p0_arg0, tid1: p0_arg1, ...},</span>
<span class="sd">                       sid1: {...}, sid2: {...}, ... },</span>
<span class="sd">                      {tid2: {sid3: p1_arg0, sid4: p1_arg1, ...},</span>
<span class="sd">                       tid3: {...}, tid4: {...}, ... }]</span>
<span class="sd">            This is useful when properties of edges such as distance is used to</span>
<span class="sd">            determine other edge properties such as delay. So the distance does</span>
<span class="sd">            not need to be calculated repeatedly. The connector can be passed</span>
<span class="sd">            as an argument for the functions that generates additional edge</span>
<span class="sd">            properties, so that they can access the information here.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">p0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">p1</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">symmetric_p1</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">p0_arg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">p1_arg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">symmetric_p1_arg</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">pr</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">pr_arg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">estimate_rho</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dist_range_forward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dist_range_backward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">n_syn0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">n_syn1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">autapses</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">quick_pop_check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cache_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">save_report</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">report_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
        <span class="n">var_set</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;p0&quot;</span><span class="p">,</span> <span class="s2">&quot;p0_arg&quot;</span><span class="p">,</span> <span class="s2">&quot;p1&quot;</span><span class="p">,</span> <span class="s2">&quot;p1_arg&quot;</span><span class="p">,</span> <span class="s2">&quot;pr&quot;</span><span class="p">,</span> <span class="s2">&quot;pr_arg&quot;</span><span class="p">,</span> <span class="s2">&quot;n_syn0&quot;</span><span class="p">,</span> <span class="s2">&quot;n_syn1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">var_set</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1</span> <span class="o">=</span> <span class="n">symmetric_p1</span> <span class="ow">and</span> <span class="n">symmetric_p1_arg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1_arg</span> <span class="o">=</span> <span class="n">symmetric_p1_arg</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">estimate_rho</span> <span class="o">=</span> <span class="n">estimate_rho</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rho</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_range_forward</span> <span class="o">=</span> <span class="n">dist_range_forward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_range_backward</span> <span class="o">=</span> <span class="n">dist_range_backward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">autapses</span> <span class="o">=</span> <span class="n">autapses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quick</span> <span class="o">=</span> <span class="n">quick_pop_check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConnectorCache</span><span class="p">(</span><span class="n">cache_data</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_rho</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_report</span> <span class="o">=</span> <span class="n">save_report</span>

        <span class="k">if</span> <span class="n">report_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">report_name</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;report_name&quot;</span><span class="p">,</span> <span class="s2">&quot;default_report.csv&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_name</span> <span class="o">=</span> <span class="n">report_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn_prop</span> <span class="o">=</span> <span class="p">[{},</span> <span class="p">{}]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># *** Two methods executed during bmtk edge creation net.add_edges() ***</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Must run this before building connections&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">:</span>
            <span class="c1"># check whether the correct populations</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_same_pop</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">quick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quick</span><span class="p">)</span>
                <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_same_pop</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">quick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quick</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Source or target population not consistent.&quot;</span><span class="p">)</span>
            <span class="c1"># Skip adding nodes for the backward stage.</span>
            <span class="k">return</span>

        <span class="c1"># Update node pools</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src_str</span><span class="si">}</span><span class="s2"> nodes do not exists&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trg_str</span><span class="si">}</span><span class="s2"> nodes do not exists&quot;</span><span class="p">)</span>

        <span class="c1"># Setup nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span> <span class="o">=</span> <span class="n">is_same_pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">quick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quick</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">node_id</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_ids</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">node_id</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_target</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ids</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

        <span class="c1"># Setup for recurrent connection</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1_arg</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;n_syn1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;n_syn0&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1_arg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;p1_arg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;p0_arg&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;p1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;p0&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">edge_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the arguments for BMTK add_edges() method&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
                <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
                <span class="s2">&quot;iterator&quot;</span><span class="p">:</span> <span class="s2">&quot;one_to_all&quot;</span><span class="p">,</span>
                <span class="s2">&quot;connection_rule&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_forward_connection</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
                <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
                <span class="s2">&quot;iterator&quot;</span><span class="p">:</span> <span class="s2">&quot;all_to_one&quot;</span><span class="p">,</span>
                <span class="s2">&quot;connection_rule&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_backward_connection</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="c1"># *** Methods executed during bmtk network.build() ***</span>
    <span class="c1"># *** Helper functions ***</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">ConnectorCache</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable</span> <span class="o">=</span> <span class="n">enable</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_next_it</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_mode</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">cache_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable</span> <span class="ow">and</span> <span class="n">cache</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cache_dict</span><span class="p">[</span><span class="n">func_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">func_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">func_name</span><span class="p">]</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">writer</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
                    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">val</span>

                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">writer</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">write_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">val</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">fetch_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">fetch</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">func_name</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">fetch</span><span class="p">:</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">reader</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">output</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span><span class="p">]</span>

                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_dict</span><span class="p">[</span><span class="n">func_name</span><span class="p">])</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">read_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_dict</span><span class="p">):</span>
                <span class="c1"># check whether outputs were written correctly</span>
                <span class="n">output_len</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
                <span class="c1"># whether any stored and have the same length</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">output_len</span> <span class="k">if</span> <span class="n">n</span><span class="p">]</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">valid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">valid</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">out_len</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">,</span> <span class="n">output_len</span><span class="p">):</span>
                        <span class="n">fetch</span> <span class="o">=</span> <span class="n">out_len</span> <span class="o">&gt;</span> <span class="mi">0</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">fetch</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning: Cache did not work properly for &quot;</span> <span class="o">+</span> <span class="n">func_name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fetch_output</span><span class="p">(</span><span class="n">func_name</span><span class="p">,</span> <span class="n">fetch</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># if output not correct, disable and use original function</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning: Cache did not work properly.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">func_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_dict</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fetch_output</span><span class="p">(</span><span class="n">func_name</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">enable</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;read&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">set_next_it</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable</span><span class="p">:</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">next_it</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">next_it</span><span class="p">():</span>
                    <span class="k">pass</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">next_it</span> <span class="o">=</span> <span class="n">next_it</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">node_2_idx_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_func</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a function that accept nodes as input</span>
<span class="sd">        to accept indices as input&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">idx_2_var</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">var_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_list</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">idx_2_var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">var_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_list</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">idx_2_var</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">iterate_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate indices of source and target for each case&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autapses</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_target</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_source</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_target</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_target</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calc_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate intermediate data that can be cached&quot;&quot;&quot;</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span>
        <span class="c1"># cache = self  # test performance for not using cache</span>
        <span class="n">p0_arg</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">p0_arg</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="n">p1_arg</span> <span class="o">=</span> <span class="n">p0_arg</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1_arg</span> <span class="k">else</span> <span class="n">cache</span><span class="o">.</span><span class="n">p1_arg</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">p0</span><span class="p">(</span><span class="n">p0_arg</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1</span> <span class="k">else</span> <span class="n">cache</span><span class="o">.</span><span class="n">p1</span><span class="p">(</span><span class="n">p1_arg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p0_arg</span><span class="p">,</span> <span class="n">p1_arg</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup_conditional_backward_probability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a function that calculates the conditional probability of</span>
<span class="sd">        backward connection given the forward connection outcome &#39;cond&#39;&quot;&quot;&quot;</span>
        <span class="c1"># For all cases, assume p0, p1, pr are all within [0, 1] already.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrong_pr</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Determine by pr for each pair</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">cond_backward</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pr</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">p0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">pr_bound</span> <span class="o">=</span> <span class="p">(</span><span class="n">p0</span> <span class="o">+</span> <span class="n">p1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">))</span>
                        <span class="c1"># check whether pr within bounds</span>
                        <span class="k">if</span> <span class="n">pr</span> <span class="o">&lt;</span> <span class="n">pr_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">pr</span> <span class="o">&gt;</span> <span class="n">pr_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">wrong_pr</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">pr</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">pr_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">pr_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">return</span> <span class="n">pr</span> <span class="o">/</span> <span class="n">p0</span> <span class="k">if</span> <span class="n">cond</span> <span class="k">else</span> <span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">pr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">p1</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">cond_backward</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pr</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">p0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">pr_bound</span> <span class="o">=</span> <span class="p">(</span><span class="n">p0</span> <span class="o">+</span> <span class="n">p1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">))</span>
                        <span class="n">pr</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">pr_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">pr_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">return</span> <span class="n">pr</span> <span class="o">/</span> <span class="n">p0</span> <span class="k">if</span> <span class="n">cond</span> <span class="k">else</span> <span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">pr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">p1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Independent case</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">cond_backward</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pr</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">p1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Dependent with fixed correlation coefficient rho</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">cond_backward</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pr</span><span class="p">):</span>
                <span class="c1"># Standard deviation of r.v. for p1</span>
                <span class="n">sd</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p1</span><span class="p">)</span> <span class="o">*</span> <span class="n">p1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="c1"># Z-score of random variable for p0</span>
                <span class="n">zs</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">)</span> <span class="o">/</span> <span class="n">p0</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="k">if</span> <span class="n">cond</span> <span class="k">else</span> <span class="o">-</span><span class="p">((</span><span class="n">p0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">p1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">*</span> <span class="n">sd</span> <span class="o">*</span> <span class="n">zs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cond_backward</span> <span class="o">=</span> <span class="n">cond_backward</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_conn_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">trg</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store p0_arg and p1_arg for a connected pair&quot;&quot;&quot;</span>
        <span class="n">sid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_ids</span><span class="p">[</span><span class="n">src</span><span class="p">]</span>
        <span class="n">tid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_ids</span><span class="p">[</span><span class="n">trg</span><span class="p">]</span>
        <span class="n">conn_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_prop</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">stage</span><span class="p">:</span>
            <span class="n">sid</span><span class="p">,</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">tid</span><span class="p">,</span> <span class="n">sid</span>  <span class="c1"># during backward, from target to source</span>
        <span class="n">trg_dict</span> <span class="o">=</span> <span class="n">conn_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">trg_dict</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_conn_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get stored value given node ids in a connection&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_prop</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">][</span><span class="n">sid</span><span class="p">][</span><span class="n">tid</span><span class="p">]</span>

    <span class="c1"># *** A sequence of major methods executed during build ***</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># If pr_arg is string, use the same value as p0_arg or p1_arg</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;pr_arg&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">pr_arg_func</span> <span class="o">=</span> <span class="s2">&quot;p1_arg&quot;</span> <span class="k">if</span> <span class="s2">&quot;1&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;pr_arg&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;p0_arg&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;pr_arg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">pr_arg_func</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pr_arg_func</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">callable_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># Make constant variables constant functions</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
                <span class="n">callable_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># record callable variables</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant_function</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callable_set</span> <span class="o">=</span> <span class="n">callable_set</span>

        <span class="c1"># Make callable variables except a few, accept index input instead</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">callable_set</span> <span class="o">-</span> <span class="p">{</span><span class="s2">&quot;p0&quot;</span><span class="p">,</span> <span class="s2">&quot;p1&quot;</span><span class="p">,</span> <span class="s2">&quot;pr&quot;</span><span class="p">}:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_2_idx_input</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">))</span>

        <span class="c1"># Set up function for pr_arg if use value from p0_arg or p1_arg</span>
        <span class="k">if</span> <span class="n">pr_arg_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pr_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr_arg</span>  <span class="c1"># use specified pr_arg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pr_arg_val</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># storing current value from p_arg</span>
            <span class="n">p_arg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pr_arg_func</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">p_arg_4_pr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">p_arg</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pr_arg_val</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">return</span> <span class="n">val</span>

            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pr_arg_func</span><span class="p">,</span> <span class="n">p_arg_4_pr</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">pr_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pr_arg_val</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_pr_arg</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">(</span><span class="n">pr_arg</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cache_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Select cacheable attrilbutes</span>
        <span class="n">cache_set</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;p0&quot;</span><span class="p">,</span> <span class="s2">&quot;p0_arg&quot;</span><span class="p">,</span> <span class="s2">&quot;p1&quot;</span><span class="p">,</span> <span class="s2">&quot;p1_arg&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1</span><span class="p">:</span>
            <span class="n">cache_set</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;p1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1_arg</span><span class="p">:</span>
            <span class="n">cache_set</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;p1_arg&quot;</span><span class="p">)</span>
        <span class="c1"># Output of callable variables will be cached</span>
        <span class="c1"># Constant functions will be called from cache but output not cached</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cache_set</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">cache_output</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callable_set</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">cache_dict</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Output of </span><span class="si">%s</span><span class="s2"> will be cached.&quot;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">cache_dict</span><span class="p">),</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup_dist_range_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Checker that determines whether to consider a pair for rho estimation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_range_forward</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_range_backward</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">checker</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
                <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="k">return</span> <span class="n">p0</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">p1</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">in_range</span><span class="p">(</span><span class="n">p_arg</span><span class="p">,</span> <span class="n">dist_range</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">p_arg</span> <span class="o">&gt;=</span> <span class="n">dist_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p_arg</span> <span class="o">&lt;=</span> <span class="n">dist_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">r0</span><span class="p">,</span> <span class="n">r1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_range_forward</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_range_backward</span>
            <span class="k">if</span> <span class="n">r1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">checker</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">in_range</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">r0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">checker</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">in_range</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">checker</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">in_range</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">in_range</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">checker</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_variables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_variables</span><span class="p">()</span>
        <span class="c1"># Intialize connection matrix and get nubmer of pairs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_stage</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>  <span class="c1"># 1 byte per entry</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">initial_all_to_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The major part of the algorithm run at beginning of BMTK iterator&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start building connection between: </span><span class="se">\n</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="n">src_str</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="n">trg_str</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span>  <span class="c1"># write mode</span>

        <span class="c1"># Estimate pr</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_rho</span><span class="p">:</span>
            <span class="n">dist_range_checker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_dist_range_checker</span><span class="p">()</span>
            <span class="n">p0p1_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">norm_fac_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># Make sure each cacheable function runs excatly once per iteration</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterate_pairs</span><span class="p">():</span>
                <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_pair</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="n">dist_range_checker</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                    <span class="n">p0p1_sum</span> <span class="o">+=</span> <span class="n">p0</span> <span class="o">*</span> <span class="n">p1</span>
                    <span class="n">norm_fac_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">p0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">)</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p1</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span>
            <span class="k">if</span> <span class="n">norm_fac_sum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rho</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="p">()</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">p0p1_sum</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm_fac_sum</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning: Estimated value of rho=</span><span class="si">%.3f</span><span class="s2"> &quot;</span>
                        <span class="s2">&quot;outside the range [-1, 1].&quot;</span> <span class="o">%</span> <span class="n">rho</span><span class="p">,</span>
                        <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Force rho to be </span><span class="si">%.0f</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rho</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Estimated value of rho=</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rho</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Time for estimating rho&quot;</span><span class="p">)</span>

        <span class="c1"># Setup function for calculating conditional backward probability</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_conditional_backward_probability</span><span class="p">()</span>

        <span class="c1"># Make random connections</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">read_mode</span><span class="p">()</span>
        <span class="n">possible_count</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterate_pairs</span><span class="p">():</span>
            <span class="n">p0_arg</span><span class="p">,</span> <span class="n">p1_arg</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_pair</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="c1"># Check whether at all possible and count</span>
            <span class="n">forward</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="n">backward</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span><span class="p">:</span>
                <span class="n">possible_count</span> <span class="o">+=</span> <span class="n">forward</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">possible_count</span> <span class="o">+=</span> <span class="p">[</span><span class="n">forward</span><span class="p">,</span> <span class="n">backward</span><span class="p">,</span> <span class="n">forward</span> <span class="ow">and</span> <span class="n">backward</span><span class="p">]</span>

            <span class="c1"># Make random decision</span>
            <span class="k">if</span> <span class="n">forward</span><span class="p">:</span>
                <span class="n">forward</span> <span class="o">=</span> <span class="n">decision</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">backward</span><span class="p">:</span>
                <span class="n">pr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pr_arg</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
                <span class="n">backward</span> <span class="o">=</span> <span class="n">decision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cond_backward</span><span class="p">(</span><span class="n">forward</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pr</span><span class="p">))</span>

            <span class="c1"># Make connection</span>
            <span class="k">if</span> <span class="n">forward</span><span class="p">:</span>
                <span class="n">n_forward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_syn0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">p0_arg</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conn_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_forward</span>
            <span class="k">if</span> <span class="n">backward</span><span class="p">:</span>
                <span class="n">n_backward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_syn1</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">conn_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_backward</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">p1_arg</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">conn_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_backward</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">p1_arg</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">next_it</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">write_mode</span><span class="p">()</span>  <span class="c1"># clear memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">possible_count</span> <span class="o">=</span> <span class="n">possible_count</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Total time for creating connection matrix&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrong_pr</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Value of &#39;pr&#39; outside the bounds occurred.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection_number_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_report</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_connection_report</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign number of synapses per iteration.</span>
<span class="sd">        Use iterator one_to_all for forward and all_to_one for backward.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nsyns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_mat</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Detect end of iteration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stage</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Done! </span><span class="se">\n</span><span class="s2">Time for building connections&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">free_memory</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">nsyns</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_forward_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to be called by BMTK iterator for forward connection&quot;&quot;&quot;</span>
        <span class="c1"># Initialize in the first iteration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_all_to_all</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Assigning forward connections.&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_connection</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_backward_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to be called by BMTK iterator for backward connection&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Assigning backward connections.&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_connection</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">free_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Free up memory after connections are built&quot;&quot;&quot;</span>
        <span class="c1"># Do not clear self.conn_prop if it will be used by conn.add_properties</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;conn_mat&quot;</span><span class="p">,</span> <span class="s2">&quot;source_list&quot;</span><span class="p">,</span> <span class="s2">&quot;target_list&quot;</span><span class="p">,</span> <span class="s2">&quot;source_ids&quot;</span><span class="p">,</span> <span class="s2">&quot;target_ids&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># *** Helper functions for verbose ***</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_nodes_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get strings with source and target population information&quot;&quot;&quot;</span>
        <span class="n">source_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">network_name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">filter_str</span>
        <span class="n">target_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">network_name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">filter_str</span>
        <span class="k">return</span> <span class="n">source_str</span><span class="p">,</span> <span class="n">target_str</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">connection_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the number of the following:</span>
<span class="sd">        n_conn: connected pairs [forward, (backward,) reciprocal]</span>
<span class="sd">        n_poss: possible connections (prob&gt;0) [forward, (backward, reciprocal)]</span>
<span class="sd">        n_pair: pairs of cells</span>
<span class="sd">        proportion: of connections in possible and total pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conn_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_mat</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">n_conn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">conn_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">n_poss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">possible_count</span><span class="p">)</span>
        <span class="n">n_pair</span> <span class="o">=</span> <span class="n">conn_mat</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span><span class="p">:</span>
            <span class="n">n_recp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">conn_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">conn_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autapses</span><span class="p">:</span>
                <span class="n">n_recp</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">conn_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">n_recp</span> <span class="o">//=</span> <span class="mi">2</span>
            <span class="n">n_conn</span> <span class="o">-=</span> <span class="n">n_recp</span>
            <span class="n">n_poss</span> <span class="o">=</span> <span class="n">n_poss</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">n_pair</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autapses</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_recp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">conn_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">conn_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">n_conn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_conn</span><span class="p">,</span> <span class="n">n_recp</span><span class="p">)</span>
        <span class="n">n_pair</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_pair</span><span class="p">)</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n_conn</span> <span class="o">/</span> <span class="n">n_poss</span><span class="p">,</span> <span class="n">n_conn</span> <span class="o">/</span> <span class="n">n_pair</span><span class="p">])</span>
        <span class="n">fraction</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fraction</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">n_conn</span><span class="p">,</span> <span class="n">n_poss</span><span class="p">,</span> <span class="n">n_pair</span><span class="p">,</span> <span class="n">fraction</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">connection_number_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print connection numbers after connections built&quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">arr2str</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">f</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="n">n_conn</span><span class="p">,</span> <span class="n">n_poss</span><span class="p">,</span> <span class="n">n_pair</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_number</span><span class="p">()</span>
        <span class="n">conn_type</span> <span class="o">=</span> <span class="s2">&quot;(all, reciprocal)&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span> <span class="k">else</span> <span class="s2">&quot;(forward, backward, reciprocal)&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Numbers of &quot;</span> <span class="o">+</span> <span class="n">conn_type</span> <span class="o">+</span> <span class="s2">&quot; connections:&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of connected pairs: (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">arr2str</span><span class="p">(</span><span class="n">n_conn</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of possible connections: (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">arr2str</span><span class="p">(</span><span class="n">n_poss</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Fraction of connected pairs in possible ones: (</span><span class="si">%s</span><span class="s2">)&quot;</span>
            <span class="o">%</span> <span class="n">arr2str</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">%.2f%%</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of total pairs: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n_pair</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Fraction of connected pairs in all pairs: (</span><span class="si">%s</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="n">arr2str</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">%.2f%%</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_connection_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save connections into a CSV file to be read from later&quot;&quot;&quot;</span>
        <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
        <span class="n">n_conn</span><span class="p">,</span> <span class="n">n_poss</span><span class="p">,</span> <span class="n">n_pair</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_number</span><span class="p">()</span>

        <span class="c1"># Extract the population name from source_str and target_str</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Source&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">src_str</span><span class="p">],</span>
            <span class="s2">&quot;Target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">trg_str</span><span class="p">],</span>
            <span class="s2">&quot;Percent connectionivity within possible connections&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">fraction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">],</span>
            <span class="s2">&quot;Percent connectionivity within all connections&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">fraction</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Append the data to the CSV file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if the file exists by trying to read it</span>
            <span class="n">existing_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">)</span>
            <span class="c1"># If no exception is raised, append without header</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="c1"># If the file does not exist, write with header</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.add_conn_prop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">trg</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Store p0_arg and p1_arg for a connected pair</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_conn_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">trg</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Store p0_arg and p1_arg for a connected pair&quot;&quot;&quot;</span>
    <span class="n">sid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_ids</span><span class="p">[</span><span class="n">src</span><span class="p">]</span>
    <span class="n">tid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_ids</span><span class="p">[</span><span class="n">trg</span><span class="p">]</span>
    <span class="n">conn_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_prop</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">stage</span><span class="p">:</span>
        <span class="n">sid</span><span class="p">,</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">tid</span><span class="p">,</span> <span class="n">sid</span>  <span class="c1"># during backward, from target to source</span>
    <span class="n">trg_dict</span> <span class="o">=</span> <span class="n">conn_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">trg_dict</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.calc_pair" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calc_pair</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate intermediate data that can be cached</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calc_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate intermediate data that can be cached&quot;&quot;&quot;</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span>
    <span class="c1"># cache = self  # test performance for not using cache</span>
    <span class="n">p0_arg</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">p0_arg</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
    <span class="n">p1_arg</span> <span class="o">=</span> <span class="n">p0_arg</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1_arg</span> <span class="k">else</span> <span class="n">cache</span><span class="o">.</span><span class="n">p1_arg</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">p0</span><span class="p">(</span><span class="n">p0_arg</span><span class="p">)</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">p0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1</span> <span class="k">else</span> <span class="n">cache</span><span class="o">.</span><span class="n">p1</span><span class="p">(</span><span class="n">p1_arg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p0_arg</span><span class="p">,</span> <span class="n">p1_arg</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.connection_number" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">connection_number</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return the number of the following:
n_conn: connected pairs [forward, (backward,) reciprocal]
n_poss: possible connections (prob&gt;0) [forward, (backward, reciprocal)]
n_pair: pairs of cells
proportion: of connections in possible and total pairs</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">connection_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the number of the following:</span>
<span class="sd">    n_conn: connected pairs [forward, (backward,) reciprocal]</span>
<span class="sd">    n_poss: possible connections (prob&gt;0) [forward, (backward, reciprocal)]</span>
<span class="sd">    n_pair: pairs of cells</span>
<span class="sd">    proportion: of connections in possible and total pairs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">conn_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_mat</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">n_conn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">conn_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">n_poss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">possible_count</span><span class="p">)</span>
    <span class="n">n_pair</span> <span class="o">=</span> <span class="n">conn_mat</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span><span class="p">:</span>
        <span class="n">n_recp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">conn_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">conn_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autapses</span><span class="p">:</span>
            <span class="n">n_recp</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">conn_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">n_recp</span> <span class="o">//=</span> <span class="mi">2</span>
        <span class="n">n_conn</span> <span class="o">-=</span> <span class="n">n_recp</span>
        <span class="n">n_poss</span> <span class="o">=</span> <span class="n">n_poss</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">n_pair</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autapses</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n_recp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">conn_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">conn_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">n_conn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_conn</span><span class="p">,</span> <span class="n">n_recp</span><span class="p">)</span>
    <span class="n">n_pair</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_pair</span><span class="p">)</span>
    <span class="n">fraction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n_conn</span> <span class="o">/</span> <span class="n">n_poss</span><span class="p">,</span> <span class="n">n_conn</span> <span class="o">/</span> <span class="n">n_pair</span><span class="p">])</span>
    <span class="n">fraction</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fraction</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">n_conn</span><span class="p">,</span> <span class="n">n_poss</span><span class="p">,</span> <span class="n">n_pair</span><span class="p">,</span> <span class="n">fraction</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.connection_number_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">connection_number_info</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Print connection numbers after connections built</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">connection_number_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print connection numbers after connections built&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">arr2str</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">f</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="n">n_conn</span><span class="p">,</span> <span class="n">n_poss</span><span class="p">,</span> <span class="n">n_pair</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_number</span><span class="p">()</span>
    <span class="n">conn_type</span> <span class="o">=</span> <span class="s2">&quot;(all, reciprocal)&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span> <span class="k">else</span> <span class="s2">&quot;(forward, backward, reciprocal)&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Numbers of &quot;</span> <span class="o">+</span> <span class="n">conn_type</span> <span class="o">+</span> <span class="s2">&quot; connections:&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of connected pairs: (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">arr2str</span><span class="p">(</span><span class="n">n_conn</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of possible connections: (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">arr2str</span><span class="p">(</span><span class="n">n_poss</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;Fraction of connected pairs in possible ones: (</span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="o">%</span> <span class="n">arr2str</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">%.2f%%</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of total pairs: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n_pair</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;Fraction of connected pairs in all pairs: (</span><span class="si">%s</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="o">%</span> <span class="n">arr2str</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">%.2f%%</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.edge_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edge_params</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Create the arguments for BMTK add_edges() method</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edge_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the arguments for BMTK add_edges() method&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
            <span class="s2">&quot;iterator&quot;</span><span class="p">:</span> <span class="s2">&quot;one_to_all&quot;</span><span class="p">,</span>
            <span class="s2">&quot;connection_rule&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_forward_connection</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
            <span class="s2">&quot;iterator&quot;</span><span class="p">:</span> <span class="s2">&quot;all_to_one&quot;</span><span class="p">,</span>
            <span class="s2">&quot;connection_rule&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_backward_connection</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">params</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.free_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">free_memory</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Free up memory after connections are built</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">free_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Free up memory after connections are built&quot;&quot;&quot;</span>
    <span class="c1"># Do not clear self.conn_prop if it will be used by conn.add_properties</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;conn_mat&quot;</span><span class="p">,</span> <span class="s2">&quot;source_list&quot;</span><span class="p">,</span> <span class="s2">&quot;target_list&quot;</span><span class="p">,</span> <span class="s2">&quot;source_ids&quot;</span><span class="p">,</span> <span class="s2">&quot;target_ids&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.get_conn_prop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_conn_prop</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get stored value given node ids in a connection</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_conn_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get stored value given node ids in a connection&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_prop</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">][</span><span class="n">sid</span><span class="p">][</span><span class="n">tid</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.get_nodes_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_nodes_info</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get strings with source and target population information</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_nodes_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get strings with source and target population information&quot;&quot;&quot;</span>
    <span class="n">source_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">network_name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">filter_str</span>
    <span class="n">target_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">network_name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">filter_str</span>
    <span class="k">return</span> <span class="n">source_str</span><span class="p">,</span> <span class="n">target_str</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.initial_all_to_all" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initial_all_to_all</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>The major part of the algorithm run at beginning of BMTK iterator</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">initial_all_to_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The major part of the algorithm run at beginning of BMTK iterator&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start building connection between: </span><span class="se">\n</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="n">src_str</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="n">trg_str</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span>  <span class="c1"># write mode</span>

    <span class="c1"># Estimate pr</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_rho</span><span class="p">:</span>
        <span class="n">dist_range_checker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_dist_range_checker</span><span class="p">()</span>
        <span class="n">p0p1_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">norm_fac_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Make sure each cacheable function runs excatly once per iteration</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterate_pairs</span><span class="p">():</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_pair</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="n">dist_range_checker</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">p0p1_sum</span> <span class="o">+=</span> <span class="n">p0</span> <span class="o">*</span> <span class="n">p1</span>
                <span class="n">norm_fac_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">p0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">)</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p1</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span>
        <span class="k">if</span> <span class="n">norm_fac_sum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rho</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="p">()</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">p0p1_sum</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm_fac_sum</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning: Estimated value of rho=</span><span class="si">%.3f</span><span class="s2"> &quot;</span>
                    <span class="s2">&quot;outside the range [-1, 1].&quot;</span> <span class="o">%</span> <span class="n">rho</span><span class="p">,</span>
                    <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Force rho to be </span><span class="si">%.0f</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rho</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Estimated value of rho=</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rho</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Time for estimating rho&quot;</span><span class="p">)</span>

    <span class="c1"># Setup function for calculating conditional backward probability</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup_conditional_backward_probability</span><span class="p">()</span>

    <span class="c1"># Make random connections</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">read_mode</span><span class="p">()</span>
    <span class="n">possible_count</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterate_pairs</span><span class="p">():</span>
        <span class="n">p0_arg</span><span class="p">,</span> <span class="n">p1_arg</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_pair</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="c1"># Check whether at all possible and count</span>
        <span class="n">forward</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">backward</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span><span class="p">:</span>
            <span class="n">possible_count</span> <span class="o">+=</span> <span class="n">forward</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">possible_count</span> <span class="o">+=</span> <span class="p">[</span><span class="n">forward</span><span class="p">,</span> <span class="n">backward</span><span class="p">,</span> <span class="n">forward</span> <span class="ow">and</span> <span class="n">backward</span><span class="p">]</span>

        <span class="c1"># Make random decision</span>
        <span class="k">if</span> <span class="n">forward</span><span class="p">:</span>
            <span class="n">forward</span> <span class="o">=</span> <span class="n">decision</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">backward</span><span class="p">:</span>
            <span class="n">pr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pr_arg</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
            <span class="n">backward</span> <span class="o">=</span> <span class="n">decision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cond_backward</span><span class="p">(</span><span class="n">forward</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pr</span><span class="p">))</span>

        <span class="c1"># Make connection</span>
        <span class="k">if</span> <span class="n">forward</span><span class="p">:</span>
            <span class="n">n_forward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_syn0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">p0_arg</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_forward</span>
        <span class="k">if</span> <span class="n">backward</span><span class="p">:</span>
            <span class="n">n_backward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_syn1</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">conn_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_backward</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">p1_arg</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conn_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_backward</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">p1_arg</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">next_it</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">write_mode</span><span class="p">()</span>  <span class="c1"># clear memory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">possible_count</span> <span class="o">=</span> <span class="n">possible_count</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Total time for creating connection matrix&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrong_pr</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Value of &#39;pr&#39; outside the bounds occurred.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_number_info</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_report</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_connection_report</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.iterate_pairs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">iterate_pairs</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Generate indices of source and target for each case</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">iterate_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate indices of source and target for each case&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autapses</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_target</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_source</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_target</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_target</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.make_backward_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_backward_connection</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Function to be called by BMTK iterator for backward connection</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_backward_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to be called by BMTK iterator for backward connection&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Assigning backward connections.&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_connection</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.make_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_connection</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Assign number of synapses per iteration.
Use iterator one_to_all for forward and all_to_one for backward.</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assign number of synapses per iteration.</span>
<span class="sd">    Use iterator one_to_all for forward and all_to_one for backward.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nsyns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_mat</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span><span class="p">,</span> <span class="p">:]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Detect end of iteration</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stage</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Done! </span><span class="se">\n</span><span class="s2">Time for building connections&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">free_memory</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">nsyns</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.make_forward_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_forward_connection</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Function to be called by BMTK iterator for forward connection</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_forward_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to be called by BMTK iterator for forward connection&quot;&quot;&quot;</span>
    <span class="c1"># Initialize in the first iteration</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_all_to_all</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Assigning forward connections.&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_connection</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.node_2_idx_input" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">node_2_idx_input</span><span class="p">(</span><span class="n">var_func</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Convert a function that accept nodes as input
to accept indices as input</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">node_2_idx_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_func</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a function that accept nodes as input</span>
<span class="sd">    to accept indices as input&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">idx_2_var</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">var_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_list</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">idx_2_var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">var_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_list</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">idx_2_var</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.save_connection_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_connection_report</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Save connections into a CSV file to be read from later</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_connection_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save connections into a CSV file to be read from later&quot;&quot;&quot;</span>
    <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
    <span class="n">n_conn</span><span class="p">,</span> <span class="n">n_poss</span><span class="p">,</span> <span class="n">n_pair</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_number</span><span class="p">()</span>

    <span class="c1"># Extract the population name from source_str and target_str</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Source&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">src_str</span><span class="p">],</span>
        <span class="s2">&quot;Target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">trg_str</span><span class="p">],</span>
        <span class="s2">&quot;Percent connectionivity within possible connections&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">fraction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s2">&quot;Percent connectionivity within all connections&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">fraction</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Append the data to the CSV file</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Check if the file exists by trying to read it</span>
        <span class="n">existing_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">)</span>
        <span class="c1"># If no exception is raised, append without header</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="c1"># If the file does not exist, write with header</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.setup_conditional_backward_probability" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_conditional_backward_probability</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Create a function that calculates the conditional probability of
backward connection given the forward connection outcome 'cond'</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_conditional_backward_probability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a function that calculates the conditional probability of</span>
<span class="sd">    backward connection given the forward connection outcome &#39;cond&#39;&quot;&quot;&quot;</span>
    <span class="c1"># For all cases, assume p0, p1, pr are all within [0, 1] already.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wrong_pr</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Determine by pr for each pair</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">cond_backward</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pr</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">p0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pr_bound</span> <span class="o">=</span> <span class="p">(</span><span class="n">p0</span> <span class="o">+</span> <span class="n">p1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">))</span>
                    <span class="c1"># check whether pr within bounds</span>
                    <span class="k">if</span> <span class="n">pr</span> <span class="o">&lt;</span> <span class="n">pr_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">pr</span> <span class="o">&gt;</span> <span class="n">pr_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">wrong_pr</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">pr</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">pr_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">pr_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">return</span> <span class="n">pr</span> <span class="o">/</span> <span class="n">p0</span> <span class="k">if</span> <span class="n">cond</span> <span class="k">else</span> <span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">pr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">p1</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">cond_backward</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pr</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">p0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pr_bound</span> <span class="o">=</span> <span class="p">(</span><span class="n">p0</span> <span class="o">+</span> <span class="n">p1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">))</span>
                    <span class="n">pr</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">pr_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">pr_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">return</span> <span class="n">pr</span> <span class="o">/</span> <span class="n">p0</span> <span class="k">if</span> <span class="n">cond</span> <span class="k">else</span> <span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">pr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">p1</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Independent case</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">cond_backward</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Dependent with fixed correlation coefficient rho</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">cond_backward</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pr</span><span class="p">):</span>
            <span class="c1"># Standard deviation of r.v. for p1</span>
            <span class="n">sd</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p1</span><span class="p">)</span> <span class="o">*</span> <span class="n">p1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
            <span class="c1"># Z-score of random variable for p0</span>
            <span class="n">zs</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">)</span> <span class="o">/</span> <span class="n">p0</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="k">if</span> <span class="n">cond</span> <span class="k">else</span> <span class="o">-</span><span class="p">((</span><span class="n">p0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">p1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">*</span> <span class="n">sd</span> <span class="o">*</span> <span class="n">zs</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cond_backward</span> <span class="o">=</span> <span class="n">cond_backward</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.ReciprocalConnector.setup_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_nodes</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Must run this before building connections</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Must run this before building connections&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">:</span>
        <span class="c1"># check whether the correct populations</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_same_pop</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">quick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quick</span><span class="p">)</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_same_pop</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">quick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quick</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Source or target population not consistent.&quot;</span><span class="p">)</span>
        <span class="c1"># Skip adding nodes for the backward stage.</span>
        <span class="k">return</span>

    <span class="c1"># Update node pools</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src_str</span><span class="si">}</span><span class="s2"> nodes do not exists&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trg_str</span><span class="si">}</span><span class="s2"> nodes do not exists&quot;</span><span class="p">)</span>

    <span class="c1"># Setup nodes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span> <span class="o">=</span> <span class="n">is_same_pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">quick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quick</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">source_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">node_id</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_ids</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">source_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">node_id</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_target</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

    <span class="c1"># Setup for recurrent connection</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurrent</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1_arg</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;n_syn1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;n_syn0&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1_arg</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;p1_arg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;p0_arg&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_p1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;p1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;p0&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="bmtool.connectors.UnidirectionConnector" class="doc doc-heading">
            <code>bmtool.connectors.UnidirectionConnector</code>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="bmtool.connectors.AbstractConnector" href="#bmtool.connectors.AbstractConnector">AbstractConnector</a></code></p>


        <p>Object for building unidirectional connections in bmtk network model with
given probability within a single population (or between two populations).</p>
<p>Parameters:
    p, p_arg: Probability of forward connection and its input argument when
        it is a function, similar to p0, p0_arg in ReciprocalConnector. It
        can be a constant or a deterministic function whose value must be
        within range [0, 1]. When p is constant, the connection is
        homogenous.
    n_syn: Number of synapses in the forward connection if connected. It
        can be a constant or a (deterministic or random) function whose
        input arguments are two node objects in BMTK like p_arg.
    verbose: Whether show verbose information in console.</p>
<p>Returns:
    An object that works with BMTK to build edges in a network.</p>
<p>Important attributes:
    vars: Dictionary that stores part of the original input parameters.
    source, target: NodePool objects for the source and target populations.
    conn_prop: A dictionaries that stores properties of connected pairs.
    Each key is the source node id and the value is a dictionary, where
    each key is the target node id that the source node connects to, and
    the value is the value of p_arg.
        Example: {sid0: {tid0: p_arg0, tid1: p_arg1, ...},
                  sid1: {...}, sid2: {...}, ... }
        This is useful in similar manner as in ReciprocalConnector.</p>








              <details class="quote">
                <summary>Source code in <code>bmtool/connectors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UnidirectionConnector</span><span class="p">(</span><span class="n">AbstractConnector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object for building unidirectional connections in bmtk network model with</span>
<span class="sd">    given probability within a single population (or between two populations).</span>

<span class="sd">    Parameters:</span>
<span class="sd">        p, p_arg: Probability of forward connection and its input argument when</span>
<span class="sd">            it is a function, similar to p0, p0_arg in ReciprocalConnector. It</span>
<span class="sd">            can be a constant or a deterministic function whose value must be</span>
<span class="sd">            within range [0, 1]. When p is constant, the connection is</span>
<span class="sd">            homogenous.</span>
<span class="sd">        n_syn: Number of synapses in the forward connection if connected. It</span>
<span class="sd">            can be a constant or a (deterministic or random) function whose</span>
<span class="sd">            input arguments are two node objects in BMTK like p_arg.</span>
<span class="sd">        verbose: Whether show verbose information in console.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An object that works with BMTK to build edges in a network.</span>

<span class="sd">    Important attributes:</span>
<span class="sd">        vars: Dictionary that stores part of the original input parameters.</span>
<span class="sd">        source, target: NodePool objects for the source and target populations.</span>
<span class="sd">        conn_prop: A dictionaries that stores properties of connected pairs.</span>
<span class="sd">        Each key is the source node id and the value is a dictionary, where</span>
<span class="sd">        each key is the target node id that the source node connects to, and</span>
<span class="sd">        the value is the value of p_arg.</span>
<span class="sd">            Example: {sid0: {tid0: p_arg0, tid1: p_arg1, ...},</span>
<span class="sd">                      sid1: {...}, sid2: {...}, ... }</span>
<span class="sd">            This is useful in similar manner as in ReciprocalConnector.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">p_arg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_syn</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_report</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">report_name</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
        <span class="n">var_set</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;p_arg&quot;</span><span class="p">,</span> <span class="s2">&quot;n_syn&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">var_set</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_report</span> <span class="o">=</span> <span class="n">save_report</span>
        <span class="k">if</span> <span class="n">report_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">report_name</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;report_name&quot;</span><span class="p">,</span> <span class="s2">&quot;default_report.csv&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_name</span> <span class="o">=</span> <span class="n">report_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn_prop</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># *** Two methods executed during bmtk edge creation net.add_edges() ***</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Must run this before building connections&quot;&quot;&quot;</span>
        <span class="c1"># Update node pools</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src_str</span><span class="si">}</span><span class="s2"> nodes do not exists&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trg_str</span><span class="si">}</span><span class="s2"> nodes do not exists&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">edge_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the arguments for BMTK add_edges() method&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
            <span class="s2">&quot;iterator&quot;</span><span class="p">:</span> <span class="s2">&quot;one_to_one&quot;</span><span class="p">,</span>
            <span class="s2">&quot;connection_rule&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_connection</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="c1"># *** Methods executed during bmtk network.build() ***</span>
    <span class="c1"># *** Helper functions ***</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_conn_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store p0_arg and p1_arg for a connected pair&quot;&quot;&quot;</span>
        <span class="n">trg_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_prop</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">trg_dict</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_conn_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get stored value given node ids in a connection&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_prop</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="n">tid</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make constant variables constant functions&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant_function</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_variables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign number of synapses per iteration using one_to_one iterator&quot;&quot;&quot;</span>
        <span class="c1"># Initialize in the first iteration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start building connection </span><span class="se">\n</span><span class="s2">  from &quot;</span> <span class="o">+</span> <span class="n">src_str</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  to &quot;</span> <span class="o">+</span> <span class="n">trg_str</span><span class="p">,</span>
                    <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Make random connections</span>

        <span class="n">p_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_arg</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="n">p_arg</span><span class="p">)</span>
        <span class="n">possible</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span> <span class="o">+=</span> <span class="n">possible</span>
        <span class="k">if</span> <span class="n">possible</span> <span class="ow">and</span> <span class="n">decision</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="n">nsyns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_syn</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="n">p_arg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nsyns</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Detect end of iteration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_number_info</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Done! </span><span class="se">\n</span><span class="s2">Time for building connections&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_report</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_connection_report</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">nsyns</span>

    <span class="c1"># *** Helper functions for verbose ***</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_nodes_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get strings with source and target population information&quot;&quot;&quot;</span>
        <span class="n">source_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">network_name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">filter_str</span>
        <span class="n">target_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">network_name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">filter_str</span>
        <span class="k">return</span> <span class="n">source_str</span><span class="p">,</span> <span class="n">target_str</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">connection_number_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print connection numbers after connections built&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of connected pairs: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of possible connections: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Fraction of connected pairs in possible ones: </span><span class="si">%.2f%%</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span>
            <span class="k">else</span> <span class="mf">0.0</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of total pairs: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Fraction of connected pairs in all pairs: </span><span class="si">%.2f%%</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span><span class="p">),</span>
            <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_connection_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save connections into a CSV file to be read from later&quot;&quot;&quot;</span>
        <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>

        <span class="n">possible_fraction</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span>
        <span class="n">all_fraction</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span>

        <span class="c1"># Extract the population name from source_str and target_str</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Source&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">src_str</span><span class="p">],</span>
            <span class="s2">&quot;Target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">trg_str</span><span class="p">],</span>
            <span class="s2">&quot;Percent connectionivity within possible connections&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">possible_fraction</span><span class="p">],</span>
            <span class="s2">&quot;Percent connectionivity within all connections&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">all_fraction</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Append the data to the CSV file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if the file exists by trying to read it</span>
            <span class="n">existing_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">)</span>
            <span class="c1"># If no exception is raised, append without header</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="c1"># If the file does not exist, write with header</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.UnidirectionConnector.add_conn_prop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Store p0_arg and p1_arg for a connected pair</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_conn_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Store p0_arg and p1_arg for a connected pair&quot;&quot;&quot;</span>
    <span class="n">trg_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_prop</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">trg_dict</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.UnidirectionConnector.connection_number_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">connection_number_info</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Print connection numbers after connections built</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">connection_number_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print connection numbers after connections built&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of connected pairs: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of possible connections: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;Fraction of connected pairs in possible ones: </span><span class="si">%.2f%%</span><span class="s2">&quot;</span>
        <span class="o">%</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span>
        <span class="k">else</span> <span class="mf">0.0</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of total pairs: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;Fraction of connected pairs in all pairs: </span><span class="si">%.2f%%</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="o">%</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span><span class="p">),</span>
        <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.UnidirectionConnector.edge_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edge_params</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Create the arguments for BMTK add_edges() method</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edge_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the arguments for BMTK add_edges() method&quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
        <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
        <span class="s2">&quot;iterator&quot;</span><span class="p">:</span> <span class="s2">&quot;one_to_one&quot;</span><span class="p">,</span>
        <span class="s2">&quot;connection_rule&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_connection</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">params</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.UnidirectionConnector.get_conn_prop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_conn_prop</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get stored value given node ids in a connection</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_conn_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get stored value given node ids in a connection&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_prop</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="n">tid</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.UnidirectionConnector.get_nodes_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_nodes_info</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get strings with source and target population information</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_nodes_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get strings with source and target population information&quot;&quot;&quot;</span>
    <span class="n">source_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">network_name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">filter_str</span>
    <span class="n">target_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">network_name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">filter_str</span>
    <span class="k">return</span> <span class="n">source_str</span><span class="p">,</span> <span class="n">target_str</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.UnidirectionConnector.make_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_connection</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Assign number of synapses per iteration using one_to_one iterator</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assign number of synapses per iteration using one_to_one iterator&quot;&quot;&quot;</span>
    <span class="c1"># Initialize in the first iteration</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start building connection </span><span class="se">\n</span><span class="s2">  from &quot;</span> <span class="o">+</span> <span class="n">src_str</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  to &quot;</span> <span class="o">+</span> <span class="n">trg_str</span><span class="p">,</span>
                <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># Make random connections</span>

    <span class="n">p_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_arg</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="n">p_arg</span><span class="p">)</span>
    <span class="n">possible</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span> <span class="o">+=</span> <span class="n">possible</span>
    <span class="k">if</span> <span class="n">possible</span> <span class="ow">and</span> <span class="n">decision</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">nsyns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_syn</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="n">p_arg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nsyns</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Detect end of iteration</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection_number_info</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Done! </span><span class="se">\n</span><span class="s2">Time for building connections&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_report</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_connection_report</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">nsyns</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.UnidirectionConnector.save_connection_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_connection_report</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Save connections into a CSV file to be read from later</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_connection_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save connections into a CSV file to be read from later&quot;&quot;&quot;</span>
    <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>

    <span class="n">possible_fraction</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span>
    <span class="n">all_fraction</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span>

    <span class="c1"># Extract the population name from source_str and target_str</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Source&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">src_str</span><span class="p">],</span>
        <span class="s2">&quot;Target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">trg_str</span><span class="p">],</span>
        <span class="s2">&quot;Percent connectionivity within possible connections&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">possible_fraction</span><span class="p">],</span>
        <span class="s2">&quot;Percent connectionivity within all connections&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">all_fraction</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Append the data to the CSV file</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Check if the file exists by trying to read it</span>
        <span class="n">existing_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">)</span>
        <span class="c1"># If no exception is raised, append without header</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="c1"># If the file does not exist, write with header</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.UnidirectionConnector.setup_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_nodes</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Must run this before building connections</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Must run this before building connections&quot;&quot;&quot;</span>
    <span class="c1"># Update node pools</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src_str</span><span class="si">}</span><span class="s2"> nodes do not exists&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trg_str</span><span class="si">}</span><span class="s2"> nodes do not exists&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.UnidirectionConnector.setup_variables" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_variables</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Make constant variables constant functions</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make constant variables constant functions&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant_function</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="bmtool.connectors.GapJunction" class="doc doc-heading">
            <code>bmtool.connectors.GapJunction</code>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="bmtool.connectors.UnidirectionConnector" href="#bmtool.connectors.UnidirectionConnector">UnidirectionConnector</a></code></p>


        <p>Object for buiilding gap junction connections in bmtk network model with
given probabilities within a single population which is uncorrelated with
the recurrent chemical synapses in this population.</p>
<p>Parameters:
    p, p_arg: Probability of forward connection and its input argument when
        it is a function, similar to p0, p0_arg in ReciprocalConnector. It
        can be a constant or a deterministic function whose value must be
        within range [0, 1]. When p is constant, the connection is
        homogenous.
    verbose: Whether show verbose information in console.</p>
<p>Returns:
    An object that works with BMTK to build edges in a network.</p>
<p>Important attributes:
    Similar to <code>UnidirectionConnector</code>.</p>








              <details class="quote">
                <summary>Source code in <code>bmtool/connectors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GapJunction</span><span class="p">(</span><span class="n">UnidirectionConnector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object for buiilding gap junction connections in bmtk network model with</span>
<span class="sd">    given probabilities within a single population which is uncorrelated with</span>
<span class="sd">    the recurrent chemical synapses in this population.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        p, p_arg: Probability of forward connection and its input argument when</span>
<span class="sd">            it is a function, similar to p0, p0_arg in ReciprocalConnector. It</span>
<span class="sd">            can be a constant or a deterministic function whose value must be</span>
<span class="sd">            within range [0, 1]. When p is constant, the connection is</span>
<span class="sd">            homogenous.</span>
<span class="sd">        verbose: Whether show verbose information in console.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An object that works with BMTK to build edges in a network.</span>

<span class="sd">    Important attributes:</span>
<span class="sd">        Similar to `UnidirectionConnector`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">p_arg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_report</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">report_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">p_arg</span><span class="o">=</span><span class="n">p_arg</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">save_report</span><span class="o">=</span><span class="n">save_report</span><span class="p">,</span> <span class="n">report_name</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup_nodes</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">):</span>
            <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Source and target must be the same for &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;gap junction. Nodes are </span><span class="si">{</span><span class="n">src_str</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">trg_str</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign gap junction per iteration using one_to_one iterator&quot;&quot;&quot;</span>
        <span class="c1"># Initialize in the first iteration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="n">src_str</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start building gap junction </span><span class="se">\n</span><span class="s2">  in &quot;</span> <span class="o">+</span> <span class="n">src_str</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Consider each pair only once</span>
        <span class="n">nsyns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">p_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_arg</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="n">p_arg</span><span class="p">)</span>
            <span class="n">possible</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span> <span class="o">+=</span> <span class="n">possible</span>
            <span class="k">if</span> <span class="n">possible</span> <span class="ow">and</span> <span class="n">decision</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="n">nsyns</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">sid</span><span class="p">,</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">node_id</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">p_arg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">tid</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">p_arg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Detect end of iteration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_number_info</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Done! </span><span class="se">\n</span><span class="s2">Time for building connections&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_report</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_connection_report</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">nsyns</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">connection_number_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n_pair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_pair</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">))</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">connection_number_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span> <span class="o">=</span> <span class="n">n_pair</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_connection_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save connections into a CSV file to be read from later&quot;&quot;&quot;</span>
        <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
        <span class="n">n_pair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span>
        <span class="n">fraction_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="n">fraction_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span>

        <span class="c1"># Convert fraction to percentage and prepare data for the DataFrame</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Source&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">src_str</span> <span class="o">+</span> <span class="s2">&quot;Gap&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">trg_str</span> <span class="o">+</span> <span class="s2">&quot;Gap&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Percent connectionivity within possible connections&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">fraction_0</span> <span class="o">*</span> <span class="mi">100</span><span class="p">],</span>
            <span class="s2">&quot;Percent connectionivity within all connections&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">fraction_1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Append the data to the CSV file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if the file exists by trying to read it</span>
            <span class="n">existing_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">)</span>
            <span class="c1"># If no exception is raised, append without header</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="c1"># If the file does not exist, write with header</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.GapJunction.make_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_connection</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Assign gap junction per iteration using one_to_one iterator</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assign gap junction per iteration using one_to_one iterator&quot;&quot;&quot;</span>
    <span class="c1"># Initialize in the first iteration</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">src_str</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start building gap junction </span><span class="se">\n</span><span class="s2">  in &quot;</span> <span class="o">+</span> <span class="n">src_str</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Consider each pair only once</span>
    <span class="n">nsyns</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
        <span class="n">p_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_arg</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="n">p_arg</span><span class="p">)</span>
        <span class="n">possible</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span> <span class="o">+=</span> <span class="n">possible</span>
        <span class="k">if</span> <span class="n">possible</span> <span class="ow">and</span> <span class="n">decision</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="n">nsyns</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">sid</span><span class="p">,</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">node_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">p_arg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">tid</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">p_arg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Detect end of iteration</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection_number_info</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Done! </span><span class="se">\n</span><span class="s2">Time for building connections&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_report</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_connection_report</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">nsyns</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.GapJunction.save_connection_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_connection_report</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Save connections into a CSV file to be read from later</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_connection_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save connections into a CSV file to be read from later&quot;&quot;&quot;</span>
    <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
    <span class="n">n_pair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span>
    <span class="n">fraction_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span> <span class="k">else</span> <span class="mf">0.0</span>
    <span class="n">fraction_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span>

    <span class="c1"># Convert fraction to percentage and prepare data for the DataFrame</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Source&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">src_str</span> <span class="o">+</span> <span class="s2">&quot;Gap&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">trg_str</span> <span class="o">+</span> <span class="s2">&quot;Gap&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Percent connectionivity within possible connections&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">fraction_0</span> <span class="o">*</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s2">&quot;Percent connectionivity within all connections&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">fraction_1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Append the data to the CSV file</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Check if the file exists by trying to read it</span>
        <span class="n">existing_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">)</span>
        <span class="c1"># If no exception is raised, append without header</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="c1"># If the file does not exist, write with header</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="bmtool.connectors.CorrelatedGapJunction" class="doc doc-heading">
            <code>bmtool.connectors.CorrelatedGapJunction</code>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="bmtool.connectors.GapJunction" href="#bmtool.connectors.GapJunction">GapJunction</a></code></p>


        <p>Object for buiilding gap junction connections in bmtk network model with
given probabilities within a single population which could be correlated
with the recurrent chemical synapses in this population.</p>
<p>Parameters:
    p_non, p_uni, p_rec: Probabilities of gap junction connection for each
        pair of cells given the following three conditions of chemical
        synaptic connections between them, no connection, unidirectional,
        and reciprocal, respectively. It can be a constant or a
        deterministic function whose value must be within range [0, 1].
    p_arg: Input argument for p_non, p_uni, or p_rec, when any of them is a
        function, similar to p0_arg, p1_arg in ReciprocalConnector.
    connector: Connector object used to generate the chemical synapses of
        within this population, which contains the connection information
        in its attribute <code>conn_prop</code>. So this connector should have
        generated the chemical synapses before generating the gap junction.
    verbose: Whether show verbose information in console.</p>
<p>Returns:
    An object that works with BMTK to build edges in a network.</p>
<p>Important attributes:
    Similar to <code>UnidirectionConnector</code>.</p>








              <details class="quote">
                <summary>Source code in <code>bmtool/connectors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CorrelatedGapJunction</span><span class="p">(</span><span class="n">GapJunction</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object for buiilding gap junction connections in bmtk network model with</span>
<span class="sd">    given probabilities within a single population which could be correlated</span>
<span class="sd">    with the recurrent chemical synapses in this population.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        p_non, p_uni, p_rec: Probabilities of gap junction connection for each</span>
<span class="sd">            pair of cells given the following three conditions of chemical</span>
<span class="sd">            synaptic connections between them, no connection, unidirectional,</span>
<span class="sd">            and reciprocal, respectively. It can be a constant or a</span>
<span class="sd">            deterministic function whose value must be within range [0, 1].</span>
<span class="sd">        p_arg: Input argument for p_non, p_uni, or p_rec, when any of them is a</span>
<span class="sd">            function, similar to p0_arg, p1_arg in ReciprocalConnector.</span>
<span class="sd">        connector: Connector object used to generate the chemical synapses of</span>
<span class="sd">            within this population, which contains the connection information</span>
<span class="sd">            in its attribute `conn_prop`. So this connector should have</span>
<span class="sd">            generated the chemical synapses before generating the gap junction.</span>
<span class="sd">        verbose: Whether show verbose information in console.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An object that works with BMTK to build edges in a network.</span>

<span class="sd">    Important attributes:</span>
<span class="sd">        Similar to `UnidirectionConnector`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">p_non</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">p_uni</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">p_rec</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">p_arg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">connector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">save_report</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">report_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">p</span><span class="o">=</span><span class="n">p_non</span><span class="p">,</span> <span class="n">p_arg</span><span class="o">=</span><span class="n">p_arg</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">save_report</span><span class="o">=</span><span class="n">save_report</span><span class="p">,</span> <span class="n">report_name</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;p_non&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;p_uni&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_uni</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;p_rec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_rec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connector</span> <span class="o">=</span> <span class="n">connector</span>
        <span class="n">conn_prop</span> <span class="o">=</span> <span class="n">connector</span><span class="o">.</span><span class="n">conn_prop</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conn_prop</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">conn_prop</span> <span class="o">=</span> <span class="n">conn_prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_conn_prop</span> <span class="o">=</span> <span class="n">conn_prop</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">conn_exist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">):</span>
        <span class="n">trg_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_conn_prop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trg_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">trg_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trg_dict</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">connection_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">):</span>
        <span class="n">conn0</span><span class="p">,</span> <span class="n">prop0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_exist</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">)</span>
        <span class="n">conn1</span><span class="p">,</span> <span class="n">prop1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_exist</span><span class="p">(</span><span class="n">tid</span><span class="p">,</span> <span class="n">sid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">conn0</span> <span class="o">+</span> <span class="n">conn1</span><span class="p">,</span> <span class="n">prop0</span> <span class="k">if</span> <span class="n">conn0</span> <span class="k">else</span> <span class="n">prop1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_p_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;p_arg&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_p_arg</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">vars</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;p_arg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;p_arg&quot;</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;p0_arg&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">p_non</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_uni</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_rec</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign gap junction per iteration using one_to_one iterator&quot;&quot;&quot;</span>
        <span class="c1"># Initialize in the first iteration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="n">src_str</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start building gap junction </span><span class="se">\n</span><span class="s2">  in &quot;</span> <span class="o">+</span> <span class="n">src_str</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Consider each pair only once</span>
        <span class="n">nsyns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">sid</span><span class="p">,</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">node_id</span>
            <span class="n">conn_type</span><span class="p">,</span> <span class="n">p_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_type</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_p_arg</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">conn_type</span><span class="p">:</span>
                <span class="n">p_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_arg</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">[</span><span class="n">conn_type</span><span class="p">](</span><span class="n">p_arg</span><span class="p">)</span>
            <span class="n">possible</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span> <span class="o">+=</span> <span class="n">possible</span>
            <span class="k">if</span> <span class="n">possible</span> <span class="ow">and</span> <span class="n">decision</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="n">nsyns</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">p_arg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">tid</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">p_arg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Detect end of iteration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_number_info</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Done! </span><span class="se">\n</span><span class="s2">Time for building connections&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_report</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_connection_report</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">nsyns</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.CorrelatedGapJunction.make_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_connection</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Assign gap junction per iteration using one_to_one iterator</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assign gap junction per iteration using one_to_one iterator&quot;&quot;&quot;</span>
    <span class="c1"># Initialize in the first iteration</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">src_str</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start building gap junction </span><span class="se">\n</span><span class="s2">  in &quot;</span> <span class="o">+</span> <span class="n">src_str</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Consider each pair only once</span>
    <span class="n">nsyns</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
        <span class="n">sid</span><span class="p">,</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">node_id</span>
        <span class="n">conn_type</span><span class="p">,</span> <span class="n">p_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_type</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_p_arg</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">conn_type</span><span class="p">:</span>
            <span class="n">p_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_arg</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">[</span><span class="n">conn_type</span><span class="p">](</span><span class="n">p_arg</span><span class="p">)</span>
        <span class="n">possible</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_poss</span> <span class="o">+=</span> <span class="n">possible</span>
        <span class="k">if</span> <span class="n">possible</span> <span class="ow">and</span> <span class="n">decision</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="n">nsyns</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">p_arg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_conn_prop</span><span class="p">(</span><span class="n">tid</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">p_arg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_conn</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Detect end of iteration</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pair</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection_number_info</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Done! </span><span class="se">\n</span><span class="s2">Time for building connections&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_report</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_connection_report</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">nsyns</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="bmtool.connectors.OneToOneSequentialConnector" class="doc doc-heading">
            <code>bmtool.connectors.OneToOneSequentialConnector</code>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="bmtool.connectors.AbstractConnector" href="#bmtool.connectors.AbstractConnector">AbstractConnector</a></code></p>


        <p>Object for buiilding one to one correspondence connections in bmtk
network model with between two populations. One of the population can
consist of multiple sub-populations. These sub-populations need to be added
sequentially using setup_nodes() and edge_params() methods followed by BMTK
add_edges() method. For example, to connect 30 nodes in population A to 30
nodes in populations B1, B2, B3, each with 10 nodes, set up as follows.
    connector = OneToOneSequentialConnector(<strong>parameters)
    connector.setup_nodes(source=A, target=B1)
    net.add_edges(</strong>connector.edge_params())
    connector.setup_nodes(target=B2)
    net.add_edges(<strong>connector.edge_params())
    connector.setup_nodes(target=B3)
    net.add_edges(</strong>connector.edge_params())
After BMTK executes net.build(), the first 10 nodes in A will connect one-
to-one to the 10 nodes in B1, then the 11 to 20-th nodes to those in B2,
finally the 21 to 30-th nodes to those in B3.
This connector is useful for creating input drives to a population. Each
node in it receives an independent drive from a unique source node.</p>
<p>Parameters:
    n_syn: Number of synapses in each connection. It accepts only constant
        for now.
    partition_source: Whether the source population consists of multiple
        sub-populations. By default, the source has one population, and the
        target can have multiple sub-populations. If set to true, the
        source can have multiple sub-populations and the target has only
        one population.
    verbose: Whether show verbose information in console.</p>
<p>Returns:
    An object that works with BMTK to build edges in a network.</p>
<p>Important attributes:
    source: NodePool object for the single population.
    targets: List of NodePool objects for the multiple sub-populations.</p>








              <details class="quote">
                <summary>Source code in <code>bmtool/connectors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">OneToOneSequentialConnector</span><span class="p">(</span><span class="n">AbstractConnector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Object for buiilding one to one correspondence connections in bmtk</span>
<span class="sd">    network model with between two populations. One of the population can</span>
<span class="sd">    consist of multiple sub-populations. These sub-populations need to be added</span>
<span class="sd">    sequentially using setup_nodes() and edge_params() methods followed by BMTK</span>
<span class="sd">    add_edges() method. For example, to connect 30 nodes in population A to 30</span>
<span class="sd">    nodes in populations B1, B2, B3, each with 10 nodes, set up as follows.</span>
<span class="sd">        connector = OneToOneSequentialConnector(**parameters)</span>
<span class="sd">        connector.setup_nodes(source=A, target=B1)</span>
<span class="sd">        net.add_edges(**connector.edge_params())</span>
<span class="sd">        connector.setup_nodes(target=B2)</span>
<span class="sd">        net.add_edges(**connector.edge_params())</span>
<span class="sd">        connector.setup_nodes(target=B3)</span>
<span class="sd">        net.add_edges(**connector.edge_params())</span>
<span class="sd">    After BMTK executes net.build(), the first 10 nodes in A will connect one-</span>
<span class="sd">    to-one to the 10 nodes in B1, then the 11 to 20-th nodes to those in B2,</span>
<span class="sd">    finally the 21 to 30-th nodes to those in B3.</span>
<span class="sd">    This connector is useful for creating input drives to a population. Each</span>
<span class="sd">    node in it receives an independent drive from a unique source node.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        n_syn: Number of synapses in each connection. It accepts only constant</span>
<span class="sd">            for now.</span>
<span class="sd">        partition_source: Whether the source population consists of multiple</span>
<span class="sd">            sub-populations. By default, the source has one population, and the</span>
<span class="sd">            target can have multiple sub-populations. If set to true, the</span>
<span class="sd">            source can have multiple sub-populations and the target has only</span>
<span class="sd">            one population.</span>
<span class="sd">        verbose: Whether show verbose information in console.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An object that works with BMTK to build edges in a network.</span>

<span class="sd">    Important attributes:</span>
<span class="sd">        source: NodePool object for the single population.</span>
<span class="sd">        targets: List of NodePool objects for the multiple sub-populations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_syn</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">partition_source</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_syn</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_syn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span> <span class="o">=</span> <span class="n">partition_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># *** Two methods executed during bmtk edge creation net.add_edges() ***</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Must run this before building connections&quot;&quot;&quot;</span>
        <span class="c1"># Update node pools</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span><span class="p">:</span>
            <span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trg_str</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot; nodes do not exists&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;Source&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span> <span class="k">else</span> <span class="s2">&quot;Target&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; nodes do not exists&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_range</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Total target populations exceed the source population.&quot;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span>
                    <span class="k">else</span> <span class="s2">&quot;Total source populations exceed the target population.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;All &quot;</span>
                <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;source&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span> <span class="k">else</span> <span class="s2">&quot;target&quot;</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot; population partitions are filled.&quot;</span><span class="p">,</span>
                <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">edge_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_pop_idx</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the arguments for BMTK add_edges() method&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">target_pop_idx</span><span class="p">],</span>
                <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
                <span class="s2">&quot;iterator&quot;</span><span class="p">:</span> <span class="s2">&quot;one_to_all&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
                <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">target_pop_idx</span><span class="p">],</span>
                <span class="s2">&quot;iterator&quot;</span><span class="p">:</span> <span class="s2">&quot;all_to_one&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;connection_rule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_connection</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="c1"># *** Methods executed during bmtk network.build() ***</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign one connection per iteration using all_to_one iterator&quot;&quot;&quot;</span>
        <span class="c1"># Initialize in the first iteration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Very beginning</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start building connection &quot;</span>
                    <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;to &quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span> <span class="k">else</span> <span class="s2">&quot;from &quot;</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">src_str</span><span class="p">,</span>
                    <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_range</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_count</span><span class="p">]:</span>
                <span class="c1"># Beginning of each target population</span>
                <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_count</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2">. &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_count</span><span class="p">)</span>
                    <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;from &quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span> <span class="k">else</span> <span class="s2">&quot;to &quot;</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">trg_str</span><span class="p">,</span>
                    <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timer_part</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

        <span class="c1"># Make connection</span>
        <span class="n">nsyns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">nsyns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_syn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Detect end of iteration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_range</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_count</span><span class="p">]:</span>
                <span class="c1"># End of each target population</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timer_part</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;    Time for this partition&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">:</span>
                <span class="c1"># Very end</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Done! </span><span class="se">\n</span><span class="s2">Time for building connections&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nsyns</span>

    <span class="c1"># *** Helper functions for verbose ***</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_nodes_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_pop_idx</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get strings with source and target population information&quot;&quot;&quot;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">target_pop_idx</span><span class="p">]</span>
        <span class="n">source_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">network_name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">filter_str</span>
        <span class="n">target_str</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">network_name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">target</span><span class="o">.</span><span class="n">filter_str</span>
        <span class="k">return</span> <span class="n">source_str</span><span class="p">,</span> <span class="n">target_str</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.OneToOneSequentialConnector.edge_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edge_params</span><span class="p">(</span><span class="n">target_pop_idx</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Create the arguments for BMTK add_edges() method</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edge_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_pop_idx</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the arguments for BMTK add_edges() method&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">target_pop_idx</span><span class="p">],</span>
            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
            <span class="s2">&quot;iterator&quot;</span><span class="p">:</span> <span class="s2">&quot;one_to_all&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">target_pop_idx</span><span class="p">],</span>
            <span class="s2">&quot;iterator&quot;</span><span class="p">:</span> <span class="s2">&quot;all_to_one&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;connection_rule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_connection</span>
    <span class="k">return</span> <span class="n">params</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.OneToOneSequentialConnector.get_nodes_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_nodes_info</span><span class="p">(</span><span class="n">target_pop_idx</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get strings with source and target population information</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_nodes_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_pop_idx</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get strings with source and target population information&quot;&quot;&quot;</span>
    <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">target_pop_idx</span><span class="p">]</span>
    <span class="n">source_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">network_name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">filter_str</span>
    <span class="n">target_str</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">network_name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">target</span><span class="o">.</span><span class="n">filter_str</span>
    <span class="k">return</span> <span class="n">source_str</span><span class="p">,</span> <span class="n">target_str</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.OneToOneSequentialConnector.make_connection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_connection</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Assign one connection per iteration using all_to_one iterator</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assign one connection per iteration using all_to_one iterator&quot;&quot;&quot;</span>
    <span class="c1"># Initialize in the first iteration</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Very beginning</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start building connection &quot;</span>
                <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;to &quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span> <span class="k">else</span> <span class="s2">&quot;from &quot;</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">src_str</span><span class="p">,</span>
                <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_range</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_count</span><span class="p">]:</span>
            <span class="c1"># Beginning of each target population</span>
            <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_count</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2">. &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_count</span><span class="p">)</span>
                <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;from &quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span> <span class="k">else</span> <span class="s2">&quot;to &quot;</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">trg_str</span><span class="p">,</span>
                <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer_part</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

    <span class="c1"># Make connection</span>
    <span class="n">nsyns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">nsyns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_syn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Detect end of iteration</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_range</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_count</span><span class="p">]:</span>
            <span class="c1"># End of each target population</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer_part</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;    Time for this partition&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">:</span>
            <span class="c1"># Very end</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Done! </span><span class="se">\n</span><span class="s2">Time for building connections&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nsyns</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bmtool.connectors.OneToOneSequentialConnector.setup_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_nodes</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Must run this before building connections</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Must run this before building connections&quot;&quot;&quot;</span>
    <span class="c1"># Update node pools</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span><span class="p">:</span>
        <span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">src_str</span><span class="p">,</span> <span class="n">trg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_info</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trg_str</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot; nodes do not exists&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;Source&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span> <span class="k">else</span> <span class="s2">&quot;Target&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; nodes do not exists&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">idx_range</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Total target populations exceed the source population.&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span>
                <span class="k">else</span> <span class="s2">&quot;Total source populations exceed the target population.&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_source</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;All &quot;</span>
            <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;source&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_source</span> <span class="k">else</span> <span class="s2">&quot;target&quot;</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot; population partitions are filled.&quot;</span><span class="p">,</span>
            <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="synapse-helper-functions">Synapse Helper Functions</h2>


<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.syn_const_delay" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">syn_const_delay</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_delay</span><span class="o">=</span><span class="n">SYN_MIN_DELAY</span><span class="p">,</span> <span class="n">velocity</span><span class="o">=</span><span class="n">SYN_VELOCITY</span><span class="p">,</span> <span class="n">fluc_stdev</span><span class="o">=</span><span class="n">FLUC_STDEV</span><span class="p">,</span> <span class="n">delay_bound</span><span class="o">=</span><span class="p">(</span><span class="n">DELAY_LOWBOUND</span><span class="p">,</span> <span class="n">DELAY_UPBOUND</span><span class="p">),</span> <span class="n">connector</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Synapse delay constant with some random fluctuation.</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">syn_const_delay</span><span class="p">(</span>
    <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dist</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">min_delay</span><span class="o">=</span><span class="n">SYN_MIN_DELAY</span><span class="p">,</span>
    <span class="n">velocity</span><span class="o">=</span><span class="n">SYN_VELOCITY</span><span class="p">,</span>
    <span class="n">fluc_stdev</span><span class="o">=</span><span class="n">FLUC_STDEV</span><span class="p">,</span>
    <span class="n">delay_bound</span><span class="o">=</span><span class="p">(</span><span class="n">DELAY_LOWBOUND</span><span class="p">,</span> <span class="n">DELAY_UPBOUND</span><span class="p">),</span>
    <span class="n">connector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Synapse delay constant with some random fluctuation.&quot;&quot;&quot;</span>
    <span class="n">del_fluc</span> <span class="o">=</span> <span class="n">fluc_stdev</span> <span class="o">*</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">()</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">SYN_VELOCITY</span> <span class="o">+</span> <span class="n">SYN_MIN_DELAY</span> <span class="o">+</span> <span class="n">del_fluc</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">DELAY_LOWBOUND</span><span class="p">),</span> <span class="n">DELAY_UPBOUND</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">delay</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.syn_dist_delay_feng" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">syn_dist_delay_feng</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">min_delay</span><span class="o">=</span><span class="n">SYN_MIN_DELAY</span><span class="p">,</span> <span class="n">velocity</span><span class="o">=</span><span class="n">SYN_VELOCITY</span><span class="p">,</span> <span class="n">fluc_stdev</span><span class="o">=</span><span class="n">FLUC_STDEV</span><span class="p">,</span> <span class="n">delay_bound</span><span class="o">=</span><span class="p">(</span><span class="n">DELAY_LOWBOUND</span><span class="p">,</span> <span class="n">DELAY_UPBOUND</span><span class="p">),</span> <span class="n">connector</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Synpase delay linearly dependent on distance.
min_delay: minimum delay (ms)
velocity: synapse conduction velocity (micron/ms)
fluc_stdev: standard deviation of random Gaussian fluctuation (ms)
delay_bound: (lower, upper) bounds of delay (ms)
connector: connector object from which to read distance</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">syn_dist_delay_feng</span><span class="p">(</span>
    <span class="n">source</span><span class="p">,</span>
    <span class="n">target</span><span class="p">,</span>
    <span class="n">min_delay</span><span class="o">=</span><span class="n">SYN_MIN_DELAY</span><span class="p">,</span>
    <span class="n">velocity</span><span class="o">=</span><span class="n">SYN_VELOCITY</span><span class="p">,</span>
    <span class="n">fluc_stdev</span><span class="o">=</span><span class="n">FLUC_STDEV</span><span class="p">,</span>
    <span class="n">delay_bound</span><span class="o">=</span><span class="p">(</span><span class="n">DELAY_LOWBOUND</span><span class="p">,</span> <span class="n">DELAY_UPBOUND</span><span class="p">),</span>
    <span class="n">connector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Synpase delay linearly dependent on distance.</span>
<span class="sd">    min_delay: minimum delay (ms)</span>
<span class="sd">    velocity: synapse conduction velocity (micron/ms)</span>
<span class="sd">    fluc_stdev: standard deviation of random Gaussian fluctuation (ms)</span>
<span class="sd">    delay_bound: (lower, upper) bounds of delay (ms)</span>
<span class="sd">    connector: connector object from which to read distance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">connector</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">euclid_dist</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">connector</span><span class="o">.</span><span class="n">get_conn_prop</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">node_id</span><span class="p">)</span>
    <span class="n">del_fluc</span> <span class="o">=</span> <span class="n">fluc_stdev</span> <span class="o">*</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">()</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">velocity</span> <span class="o">+</span> <span class="n">min_delay</span> <span class="o">+</span> <span class="n">del_fluc</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">delay_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">delay_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">delay</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.syn_section_PN" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">syn_section_PN</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">sec_id</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sec_x</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Synapse location follows a Bernoulli distribution, with probability p
to obtain the former in sec_id and sec_x</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">syn_section_PN</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">sec_id</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sec_x</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Synapse location follows a Bernoulli distribution, with probability p</span>
<span class="sd">    to obtain the former in sec_id and sec_x&quot;&quot;&quot;</span>
    <span class="n">syn_loc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="ow">not</span> <span class="n">decision</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sec_id</span><span class="p">[</span><span class="n">syn_loc</span><span class="p">],</span> <span class="n">sec_x</span><span class="p">[</span><span class="n">syn_loc</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.syn_const_delay_feng_section_PN" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">syn_const_delay_feng_section_PN</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">sec_id</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sec_x</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Assign both synapse delay and location with constant distance assumed</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">syn_const_delay_feng_section_PN</span><span class="p">(</span>
    <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">sec_id</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sec_x</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assign both synapse delay and location with constant distance assumed&quot;&quot;&quot;</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="n">syn_const_delay</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">s_id</span><span class="p">,</span> <span class="n">s_x</span> <span class="o">=</span> <span class="n">syn_section_PN</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">sec_id</span><span class="o">=</span><span class="n">sec_id</span><span class="p">,</span> <span class="n">sec_x</span><span class="o">=</span><span class="n">sec_x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">delay</span><span class="p">,</span> <span class="n">s_id</span><span class="p">,</span> <span class="n">s_x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.syn_dist_delay_feng_section_PN" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">syn_dist_delay_feng_section_PN</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">sec_id</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sec_x</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">

        <p>Assign both synapse delay and location</p>


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">syn_dist_delay_feng_section_PN</span><span class="p">(</span>
    <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">sec_id</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sec_x</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assign both synapse delay and location&quot;&quot;&quot;</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="n">syn_dist_delay_feng</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">s_id</span><span class="p">,</span> <span class="n">s_x</span> <span class="o">=</span> <span class="n">syn_section_PN</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">sec_id</span><span class="o">=</span><span class="n">sec_id</span><span class="p">,</span> <span class="n">sec_x</span><span class="o">=</span><span class="n">sec_x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">delay</span><span class="p">,</span> <span class="n">s_id</span><span class="p">,</span> <span class="n">s_x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bmtool.connectors.syn_uniform_delay_section" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bmtool</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">syn_uniform_delay_section</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="n">DELAY_LOWBOUND</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">DELAY_UPBOUND</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents first">


            <details class="quote">
              <summary>Source code in <code>bmtool/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2232</span>
<span class="normal">2233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">syn_uniform_delay_section</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="n">DELAY_LOWBOUND</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">DELAY_UPBOUND</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/cyneuro/bmtool" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../javascripts/notebook-download.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>